
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Advent 2017 - Reading From the Firehose With Fable - Mavnn's blog</title>
  <meta name="author" content="mavnn">

  
  <meta name="description" content="Each year, the F# programming community creates an advent calendar of blog posts, coordinated by Sergey Tihon his blog. I really like the idea, and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://blog.mavnn.co.uk/advent-2017-reading-from-the-firehose-with-fable/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mavnn's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Fira+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Fira+Mono:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37561687-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body   >
  <header role="banner"><hgroup>
  <a href="https://mavnn.co.uk"><img class="swirl-logo" src="/images/swirl.svg"/></a>
  <h1><a href="/">Mavnn's blog</a></h1>
  
    <h2>Stuff from my brain</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="#" method="get" id="searchbox" >
  <fieldset role="search">
    <input type="hidden" id="site_query" value="site:blog.mavnn.co.uk" />
    <input class="search" type="text" name="q" results="0" id="search_query" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="https://mavnn.co.uk">Main Site</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  

<!-- for the course -->
<!-- <h5>We're running <a href="/cloud-native-net/">Cloud Native .NET</a> in Brighton, 26th-27th April 2018. High quality training for building .NET Core, distributed, production ready systems.</h5> -->
<!-- take it out up to here... -->



  <header>
    
      <h1 class="entry-title">Advent 2017 - Reading From the Firehose With Fable</h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-12-04T13:00:00+00:00" pubdate data-updated="true">Dec 4<span>th</span>, 2017</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Each year, the F# programming community creates an advent calendar of blog posts, coordinated by Sergey Tihon <a href="https://sergeytihon.com/2017/10/22/f-advent-calendar-in-english-2017/">his blog</a>.</p>

<p>I really like the idea, and have taken part in <a href="https://blog.mavnn.co.uk/advent-2016/">2016</a>, <a href="https://blog.mavnn.co.uk/angels-from-the-realms-of-glory/">2015</a> &amp; <a href="https://blog.mavnn.co.uk/modelling-inheritance-with-inheritance/">2014</a>.</p>

<p>Below is this year&#39;s post.</p>

<h1>The plan: speed read Christmas</h1>

<p>So; you want to find out what Christmas is about, where it really came from&#8230; but you don&#39;t have much time.</p>

<p>The solution is obvious: take the famous bible passages that churches read every year, and speed read them!</p>

<p>Let&#39;s build an app to help us with that.</p>

<!-- more -->

<h2>The tools: Fable and Elmish</h2>

<p><a href="https://fable-elmish.github.io/elmish/">Fable</a> is a F# to JavaScript compiler, and <a href="https://fable-elmish.github.io/elmish/">Elmish</a> is a library for it designed to provide a Elm/Redux style workflow around it.</p>

<p>If you haven&#39;t used Elm or Redux before, the basic idea is that our application will be based around three things:</p>

<ul>
<li>A state type. This type will contain all of the information about the state of the application at any moment</li>
<li>A message type. This will be a discriminated union with a case for each type of &quot;message&quot; that can update the state of the application.</li>
<li>An update function. This is called every time a message is triggered; it takes the previous state and the message that has just arrived, and produces a new state.</li>
</ul>

<p>These three things are all we need to manage the state of the application, but then we end up needing one final concept: subscribers.</p>

<p>Subscribers can take the current state, but more importantly they are passed a &quot;dispatch&quot; function that allows them to dispatch messages to the applications message queue. This is how we deal with all inputs in an Elmish application, whether from a user or whether it&#39;s things like network requests completing and delivering information our application needs.</p>

<p>The main, most important subscriber is the &quot;view&quot; (i.e. how we&#39;re going to show things to the user). In our app, our view will be displayed via a Fable wrapper for React, creating a single page web application. The view is nearly always capable of also dispatching messages - this is how we model things like buttons the user can click on.</p>

<p>You can find more about this, with pretty diagrams, on the Fable Elmish website linked above.</p>

<h2>Getting started</h2>

<p>Let&#39;s start by setting up the application framework. We&#39;ll need dotnet core installed, and node with a reasonably recent version of yarn if you want to follow along at home.</p>

<p>Make yourself a new directory, and then on the command line you can run the following commands:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>dotnet new -i Fable.Template
</span></code></pre></td></tr></table></div></figure>

<p>Installs the Fable template for dotnet core.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>dotnet new fable
</span></code></pre></td></tr></table></div></figure>

<p>Creates a new Fable project in this directory, using the directory name for the project name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>yarn install
</span><span class='line'>dotnet restore
</span></code></pre></td></tr></table></div></figure>

<p>Download all the basic dependencies, both for dotnet and JavaScript.</p>

<h2>Adding our dependencies</h2>

<p>Apart from using Fable itself, we also want to make use of Elmish and it&#39;s React plugin.</p>

<p>Add these two libraries to paket.dependencies:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>nuget Fable.Elmish.Browser
</span><span class='line'>nuget Fable.Elmish.React
</span></code></pre></td></tr></table></div></figure>

<p>Then in the src directory add them to our Fable project as well (in paket.references):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Fable.Elmish.Browser
</span><span class='line'>Fable.Elmish.React
</span></code></pre></td></tr></table></div></figure>

<p>Run a paket install to download and add the dotnet parts of the libraries to your project:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mono .paket/paket.exe install
</span></code></pre></td></tr></table></div></figure>

<p>Then go into the &quot;src&quot; directory and add the JavaScript libraries that these Fable libraries depend on in the browser.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>src
</span><span class='line'>yarn add react react-dom
</span><span class='line'>dotnet restore
</span></code></pre></td></tr></table></div></figure>

<h2>Setting up the webpage</h2>

<p>Let&#39;s adapt our HTML, in the &quot;public&quot; folder. The Fable template project assumes that we&#39;re going to be using a canvas. We&#39;re writing a text only application, so we&#39;ll just replace the canvas node with a standard <code>div</code> and mark it with an id which we&#39;ll use to tell react where to render the html our code will generate.</p>

<p>Your index.html should end up looking like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!doctype html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Simple Fable App<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&#39;Content-Type&#39;</span> <span class="na">content=</span><span class="s">&#39;text/html; charset=utf-8&#39;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">href=</span><span class="s">&quot;fable.ico&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span>  <span class="na">href=</span><span class="s">&quot;index.css&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;https://cdn.polyfill.io/v2/polyfill.js?features=es6,fetch&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;react-element&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;bundle.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>We&#39;re going to speed read by displaying each word of the text really big in the middle of the screen one by one (so that you don&#39;t need to move your eyes to read).</p>

<p>Add in a <code>index.css</code> file with the following to set up styles for a large centered container and a class for displaying really large text.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">html</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-family</span><span class="o">:</span> <span class="k">sans-serif</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.container</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">text-align</span><span class="o">:</span> <span class="k">center</span><span class="p">;</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">top</span><span class="o">:</span> <span class="m">50</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>  <span class="k">left</span><span class="o">:</span> <span class="m">50</span><span class="o">%</span><span class="p">;</span>
</span><span class='line'>  <span class="n">transform</span><span class="o">:</span> <span class="n">translate</span><span class="p">(</span><span class="m">-50</span><span class="o">%,</span> <span class="m">-50</span><span class="o">%</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nc">.theText</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">5em</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

<h2>Writing &quot;JavaScript&quot;</h2>

<p>Fable compiles F# to JavaScript, and comes with tooling to watch your code and update it automatically.</p>

<p>Fire up yarn by going into your &quot;src&quot; directory and running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nt">dotnet</span> <span class="nt">fable</span> <span class="nt">yarn-start</span>
</span></code></pre></td></tr></table></div></figure>

<p>This will start the fable compiler and keep it running in the background.</p>

<p>We&#39;ve already decided we want to use Elmish with the React view. We&#39;re also going to be loading some external data so we&#39;ll want access to the Fetch API.</p>

<p>Let&#39;s open up all the namespaces which might be relevant:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">module</span> <span class="nc">Advent2017</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nc">System</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">Core</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Core</span><span class="p">.</span><span class="nc">JsInterop</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">Import</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">Browser</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">React</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">ReactDom</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Helpers</span><span class="p">.</span><span class="nn">React</span><span class="p">.</span><span class="nc">Props</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">PowerPack</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">PowerPack</span><span class="p">.</span><span class="nc">Fetch</span>
</span><span class='line'><span class="k">open</span> <span class="nc">Elmish</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Elmish</span><span class="p">.</span><span class="nc">React</span>
</span><span class='line'><span class="k">module</span> <span class="nc">R</span> <span class="o">=</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Helpers</span><span class="p">.</span><span class="nc">React</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then we need a model; this holds all of the state of our app. The text to be speed read will be stored as an array of strings; we&#39;ll keep a <code>Max</code> field with the index of the last word to make our logic nice and explicit, the <code>Index</code> of the word currently being displayed, the number of ticks <code>SinceLast</code> time we updated the word and the current number of <code>TicksPerUpdate</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">Model</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">{</span> <span class="nc">Text</span> <span class="o">:</span> <span class="kt">string</span> <span class="bp">[]</span>
</span><span class='line'>      <span class="nc">Max</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">Index</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">SinceLast</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">TicksPerUpdate</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>The <code>Msg</code> type represents all the ways that our app can be updated. The user can ask for the text to become faster, or slower; we can finish loading the text via a web request; and a <code>Tick</code> of our timer can go past.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">Msg</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Faster</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Slower</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">ReceivedText</span> <span class="k">of</span> <span class="kt">string</span> <span class="bp">[]</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Tick</span>
</span></code></pre></td></tr></table></div></figure>

<p>And the actual update logic takes one of those messages and a previous state, and gives us a new state:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">msg</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Tick</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">{</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">tpu</span><span class="o">;</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">sl</span> <span class="o">}</span> <span class="k">when</span> <span class="n">sl</span> <span class="o">&gt;=</span> <span class="n">tpu</span> <span class="o">&amp;&amp;</span> <span class="n">tpu</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>                <span class="nc">Index</span> <span class="o">=</span> <span class="n">min</span> <span class="n">model</span><span class="o">.</span><span class="nc">Max</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>                <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">{</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">tpu</span><span class="o">;</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">sl</span> <span class="o">}</span> <span class="k">when</span> <span class="n">sl</span> <span class="o">&gt;=</span> <span class="o">(</span><span class="n">tpu</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">tpu</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>                <span class="nc">Index</span> <span class="o">=</span> <span class="n">max</span> <span class="mi">0</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>                <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">SinceLast</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Faster</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Slower</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">ReceivedText</span> <span class="n">text</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>            <span class="nc">Text</span> <span class="o">=</span> <span class="n">text</span>
</span><span class='line'>            <span class="nc">Max</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">text</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>I was feeling a bit silly, so you can make the application go &quot;so fast it goes backwards.&quot; I mean, I&#39;ve had user requirements that make less sense than that before!</p>

<p>Having defined our types and abstract logic, we now need to write the actual functionality of our app, working our way up to a method which starts it off with an initial state.</p>

<p>First some low level grunge for downloading the text we want to read.</p>

<p>We&#39;ll need a url and an auth token for the API we&#39;re using (esv.org provide a really nice API by the way).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">requestUri</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">[</span> <span class="s2">&quot;https://api.esv.org/v3/passage/text/?q=John%201&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-passage-references=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-first-verse-numbers=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-verse-numbers=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-footnotes=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-footnote-body=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-passage-horizontal-lines=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-heading-horizontal-lines=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-headings=false&quot;</span>
</span><span class='line'>      <span class="o">]</span> <span class="o">|&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">authToken</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>We&#39;ve split it up over multiple lines to make it readable as I&#39;m specifying a lot of options. Nearly all of the them boil down to removing optional metadata from the text (such as verse numbers and translation footnotes). For speed reading we just want the actual words. If you want to run this application a lot, you&#39;ll need to register your application on esv.org to get your own auth token.</p>

<p>The text it tries to download is John 1; it&#39;s one of the most famous Christmas texts, but also very poetic in it&#39;s presentation. I love it, but if you just want &quot;the Christmas story&quot; try a base url of <code>&quot;https://api.esv.org/v3/passage/text/?q=Luke%201-Luke%202:21&quot;</code> instead.</p>

<p>Now, some boiler plate to extract the passage from the JSON blob that esv.org send back to us. I&#39;m totally ignoring any errors that might occur in the request here, you probably don&#39;t want to do that in a real application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">toText</span> <span class="o">(</span><span class="n">res</span> <span class="o">:</span> <span class="nc">Response</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="bp">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="o">(|</span><span class="nc">Val</span><span class="o">|_|)</span> <span class="n">key</span> <span class="o">=</span> <span class="nn">Map</span><span class="p">.</span><span class="n">ofSeq</span> <span class="o">&gt;&gt;</span> <span class="o">(</span><span class="nn">Map</span><span class="p">.</span><span class="n">tryFind</span> <span class="n">key</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">extractPassage</span> <span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="kt">string</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">json</span> <span class="o">=</span> <span class="nn">Json</span><span class="p">.</span><span class="n">ofString</span> <span class="n">str</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">json</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Ok</span> <span class="o">(</span><span class="nn">Json</span><span class="p">.</span><span class="nc">Object</span> <span class="o">(</span><span class="nc">Val</span> <span class="s2">&quot;passages&quot;</span> <span class="o">(</span><span class="nn">Json</span><span class="p">.</span><span class="nc">Array</span> <span class="o">[|</span><span class="nn">Json</span><span class="p">.</span><span class="nc">String</span> <span class="n">first</span><span class="o">|])))</span> <span class="o">-&gt;</span> <span class="n">first</span>
</span><span class='line'>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="s2">&quot;Error&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">getText</span> <span class="n">dispatch</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">fetch</span> <span class="n">requestUri</span> <span class="o">[</span> <span class="n">requestHeaders</span> <span class="o">[</span> <span class="nc">Authorization</span> <span class="o">&lt;|</span> <span class="n">sprintf</span> <span class="s2">&quot;Token %s&quot;</span> <span class="n">authToken</span> <span class="o">]</span> <span class="o">]</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">bind</span> <span class="n">toText</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">map</span> <span class="n">extractPassage</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">text</span> <span class="o">-&gt;</span> <span class="n">text</span><span class="o">.</span><span class="nc">Split</span><span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">empty</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;,</span> <span class="nn">StringSplitOptions</span><span class="p">.</span><span class="nc">RemoveEmptyEntries</span><span class="o">)</span>
</span><span class='line'>                                 <span class="o">|&gt;</span> <span class="nc">ReceivedText</span>
</span><span class='line'>                                 <span class="o">|&gt;</span> <span class="n">dispatch</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>So <code>getText</code> will, when passed a <code>dispatch</code> function, call our Url, get the text of he body, throw away everything apart from the text of the passage we actually requested, and then split the passage on any whitespace.</p>

<p>We also want regular <code>ticks</code> coming through and prompting us to move onto the next word (or the previous if we&#39;re going backwards&#8230;).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">triggerUpdate</span> <span class="o">(</span><span class="n">dispatch</span> <span class="o">:</span> <span class="nc">Msg</span> <span class="o">-&gt;</span> <span class="kt">unit</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span><span class="o">((</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Tick</span><span class="o">),</span> <span class="mi">100</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</span></code></pre></td></tr></table></div></figure>

<p>Next up, we need our view. The view will both receive new versions of the model as they are created, but will also receive a dispatch functions so it can feed new messages into our <code>update</code> function.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">view</span> <span class="n">model</span> <span class="n">dispatch</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">model</span><span class="o">.</span><span class="nc">Text</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="n">t</span> <span class="k">when</span> <span class="nn">Array</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">t</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span>
</span><span class='line'>            <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span> <span class="o">[</span><span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Loading...&quot;</span><span class="o">]</span> <span class="o">]</span>
</span><span class='line'>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="o">[</span> <span class="nc">ClassName</span> <span class="s2">&quot;container&quot;</span> <span class="o">]</span>
</span><span class='line'>            <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">button</span> <span class="o">[</span> <span class="nc">OnClick</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Faster</span><span class="o">)</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Faster&quot;</span> <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="o">[</span> <span class="nc">ClassName</span> <span class="s2">&quot;theText&quot;</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="n">model</span><span class="o">.</span><span class="nn">Text</span><span class="p">.</span><span class="err">[</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span><span class="o">]</span>  <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">button</span> <span class="o">[</span> <span class="nc">OnClick</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Slower</span><span class="o">)</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Slower&quot;</span> <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="o">&lt;|</span> <span class="n">sprintf</span> <span class="s2">&quot;Ticks Per Update: %d&quot;</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">]</span> <span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>It displays a placeholder while we&#39;re loading data, and then buttons to speed up and slow down the speed reading rate.</p>

<p>Finally, we can fire up our application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">init</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">{</span> <span class="nc">Text</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">empty</span>
</span><span class='line'>      <span class="nc">Max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">Index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nn">Program</span><span class="p">.</span><span class="n">mkSimple</span> <span class="n">init</span> <span class="n">update</span> <span class="o">(</span><span class="n">lazyView2</span> <span class="n">view</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withSubscription</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">ofSub</span> <span class="n">getText</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withSubscription</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">ofSub</span> <span class="n">triggerUpdate</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withReact</span> <span class="s2">&quot;react-element&quot;</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>

<p>We just set our initial state and then tell react which element in our html we want to render our view in. Because we are registering <code>getText</code> and <code>triggerUpdate</code> as subscriptions, they will be passed a <code>dispatch</code> function and kicked off immediately, so the first thing our app will do is try and download the text.</p>

<p>Once the text is loaded, we&#39;ll start going forwards through the text, and are buttons for reading faster and slower will be displayed.</p>

<p>Let&#39;s see it in action:</p>

<p><img src="/images/speed_reading.gif" alt="The speed reader in action"></p>

<p>And there we have it - I hope you&#39;ll enjoy this brief trip into writing user interfaces in F#, and your <em>speedy</em> recap of one of the most famous readings from the Christmas story!</p>

<h2>Appendix: The full App.fs</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">module</span> <span class="nc">Advent2017</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nc">System</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">Core</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Core</span><span class="p">.</span><span class="nc">JsInterop</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">Import</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">Browser</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">React</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Import</span><span class="p">.</span><span class="nc">ReactDom</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Helpers</span><span class="p">.</span><span class="nn">React</span><span class="p">.</span><span class="nc">Props</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nc">PowerPack</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">PowerPack</span><span class="p">.</span><span class="nc">Fetch</span>
</span><span class='line'><span class="k">open</span> <span class="nc">Elmish</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Elmish</span><span class="p">.</span><span class="nc">React</span>
</span><span class='line'><span class="k">module</span> <span class="nc">R</span> <span class="o">=</span> <span class="nn">Fable</span><span class="p">.</span><span class="nn">Helpers</span><span class="p">.</span><span class="nc">React</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">Model</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">{</span> <span class="nc">Text</span> <span class="o">:</span> <span class="kt">string</span> <span class="bp">[]</span>
</span><span class='line'>      <span class="nc">Max</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">Index</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">SinceLast</span> <span class="o">:</span> <span class="kt">int</span>
</span><span class='line'>      <span class="nc">TicksPerUpdate</span> <span class="o">:</span> <span class="kt">int</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">Msg</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Faster</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Slower</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">ReceivedText</span> <span class="k">of</span> <span class="kt">string</span> <span class="bp">[]</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Tick</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">update</span> <span class="n">msg</span> <span class="n">model</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">msg</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Tick</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">{</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">tpu</span><span class="o">;</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">sl</span> <span class="o">}</span> <span class="k">when</span> <span class="n">sl</span> <span class="o">&gt;=</span> <span class="n">tpu</span> <span class="o">&amp;&amp;</span> <span class="n">tpu</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>                <span class="nc">Index</span> <span class="o">=</span> <span class="n">min</span> <span class="n">model</span><span class="o">.</span><span class="nc">Max</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>                <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">{</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">tpu</span><span class="o">;</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">sl</span> <span class="o">}</span> <span class="k">when</span> <span class="n">sl</span> <span class="o">&gt;=</span> <span class="o">(</span><span class="n">tpu</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">tpu</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>                <span class="nc">Index</span> <span class="o">=</span> <span class="n">max</span> <span class="mi">0</span> <span class="o">(</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
</span><span class='line'>                <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">}</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">SinceLast</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">SinceLast</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Faster</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Slower</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span> <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">ReceivedText</span> <span class="n">text</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="o">{</span> <span class="n">model</span> <span class="k">with</span>
</span><span class='line'>            <span class="nc">Text</span> <span class="o">=</span> <span class="n">text</span>
</span><span class='line'>            <span class="nc">Max</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">length</span> <span class="n">text</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">requestUri</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">[</span> <span class="s2">&quot;https://api.esv.org/v3/passage/text/?q=John%201&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-passage-references=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-first-verse-numbers=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-verse-numbers=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-footnotes=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-footnote-body=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-passage-horizontal-lines=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-heading-horizontal-lines=false&quot;</span>
</span><span class='line'>      <span class="s2">&quot;&amp;include-headings=false&quot;</span>
</span><span class='line'>      <span class="o">]</span> <span class="o">|&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">authToken</span> <span class="o">=</span> <span class="s2">&quot;TEST&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">toText</span> <span class="o">(</span><span class="n">res</span> <span class="o">:</span> <span class="nc">Response</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="bp">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="o">(|</span><span class="nc">Val</span><span class="o">|_|)</span> <span class="n">key</span> <span class="o">=</span> <span class="nn">Map</span><span class="p">.</span><span class="n">ofSeq</span> <span class="o">&gt;&gt;</span> <span class="o">(</span><span class="nn">Map</span><span class="p">.</span><span class="n">tryFind</span> <span class="n">key</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">extractPassage</span> <span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="kt">string</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">json</span> <span class="o">=</span> <span class="nn">Json</span><span class="p">.</span><span class="n">ofString</span> <span class="n">str</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">json</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">Ok</span> <span class="o">(</span><span class="nn">Json</span><span class="p">.</span><span class="nc">Object</span> <span class="o">(</span><span class="nc">Val</span> <span class="s2">&quot;passages&quot;</span> <span class="o">(</span><span class="nn">Json</span><span class="p">.</span><span class="nc">Array</span> <span class="o">[|</span><span class="nn">Json</span><span class="p">.</span><span class="nc">String</span> <span class="n">first</span><span class="o">|])))</span> <span class="o">-&gt;</span> <span class="n">first</span>
</span><span class='line'>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="s2">&quot;Error&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">getText</span> <span class="n">dispatch</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">fetch</span> <span class="n">requestUri</span> <span class="o">[</span> <span class="n">requestHeaders</span> <span class="o">[</span> <span class="nc">Authorization</span> <span class="o">&lt;|</span> <span class="n">sprintf</span> <span class="s2">&quot;Token %s&quot;</span> <span class="n">authToken</span> <span class="o">]</span> <span class="o">]</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">bind</span> <span class="n">toText</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">map</span> <span class="n">extractPassage</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Promise</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">text</span> <span class="o">-&gt;</span> <span class="n">text</span><span class="o">.</span><span class="nc">Split</span><span class="o">(</span><span class="nn">Array</span><span class="p">.</span><span class="n">empty</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;,</span> <span class="nn">StringSplitOptions</span><span class="p">.</span><span class="nc">RemoveEmptyEntries</span><span class="o">)</span>
</span><span class='line'>                                 <span class="o">|&gt;</span> <span class="nc">ReceivedText</span>
</span><span class='line'>                                 <span class="o">|&gt;</span> <span class="n">dispatch</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">triggerUpdate</span> <span class="o">(</span><span class="n">dispatch</span> <span class="o">:</span> <span class="nc">Msg</span> <span class="o">-&gt;</span> <span class="kt">unit</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">window</span><span class="o">.</span><span class="n">setInterval</span><span class="o">((</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Tick</span><span class="o">),</span> <span class="mi">100</span><span class="o">)</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">view</span> <span class="n">model</span> <span class="n">dispatch</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">model</span><span class="o">.</span><span class="nc">Text</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="n">t</span> <span class="k">when</span> <span class="nn">Array</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">t</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span>
</span><span class='line'>            <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span> <span class="o">[</span><span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Loading...&quot;</span><span class="o">]</span> <span class="o">]</span>
</span><span class='line'>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="o">[</span> <span class="nc">ClassName</span> <span class="s2">&quot;container&quot;</span> <span class="o">]</span>
</span><span class='line'>            <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">button</span> <span class="o">[</span> <span class="nc">OnClick</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Faster</span><span class="o">)</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Faster&quot;</span> <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="o">[</span> <span class="nc">ClassName</span> <span class="s2">&quot;theText&quot;</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="n">model</span><span class="o">.</span><span class="nn">Text</span><span class="p">.</span><span class="err">[</span><span class="n">model</span><span class="o">.</span><span class="nc">Index</span><span class="o">]</span>  <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">button</span> <span class="o">[</span> <span class="nc">OnClick</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">dispatch</span> <span class="nc">Slower</span><span class="o">)</span> <span class="o">]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="s2">&quot;Slower&quot;</span> <span class="o">]</span>
</span><span class='line'>              <span class="nn">R</span><span class="p">.</span><span class="n">div</span> <span class="bp">[]</span> <span class="o">[</span> <span class="nn">R</span><span class="p">.</span><span class="n">str</span> <span class="o">&lt;|</span> <span class="n">sprintf</span> <span class="s2">&quot;Ticks Per Update: %d&quot;</span> <span class="n">model</span><span class="o">.</span><span class="nc">TicksPerUpdate</span> <span class="o">]</span> <span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">init</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">{</span> <span class="nc">Text</span> <span class="o">=</span> <span class="nn">Array</span><span class="p">.</span><span class="n">empty</span>
</span><span class='line'>      <span class="nc">Max</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">Index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">SinceLast</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>      <span class="nc">TicksPerUpdate</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nn">Program</span><span class="p">.</span><span class="n">mkSimple</span> <span class="n">init</span> <span class="n">update</span> <span class="o">(</span><span class="n">lazyView2</span> <span class="n">view</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withSubscription</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">ofSub</span> <span class="n">getText</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withSubscription</span> <span class="o">(</span><span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="nn">Cmd</span><span class="p">.</span><span class="n">ofSub</span> <span class="n">triggerUpdate</span><span class="o">)</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">withReact</span> <span class="s2">&quot;react-element&quot;</span>
</span><span class='line'><span class="o">|&gt;</span> <span class="nn">Program</span><span class="p">.</span><span class="n">run</span>
</span></code></pre></td></tr></table></div></figure>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">mavnn</span></span>

      








  


<time datetime="2017-12-04T13:00:00+00:00" pubdate data-updated="true">Dec 4<span>th</span>, 2017</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/fable/'>fable</a>, <a class='category' href='/blog/categories/fsadvent/'>fsadvent</a>, <a class='category' href='/blog/categories/fsharp/'>fsharp</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://blog.mavnn.co.uk/advent-2017-reading-from-the-firehose-with-fable/" data-via="mavnn" data-counturl="https://blog.mavnn.co.uk/advent-2017-reading-from-the-firehose-with-fable/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/going-down-the-property-based-testing-rabbit-hole/" title="Previous Post: Going Down the Property Based Testing Rabbit Hole">&laquo; Going Down the Property Based Testing Rabbit Hole</a>
      
      
        <a class="basic-alignment right" href="/f-number-through-a-ruby-lens/" title="Next Post: F# Through a Ruby Lens">F# Through a Ruby Lens &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Hire the Author</h1>
  <p>
    Want some help in any of the areas you've read about? Hop across to
    <a href="https://mavnn.co.uk">mavnn.co.uk</a> where you can hire the
    author.
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/working-from-home/">Working From Home, Pandemic Edition</a>
      </li>
    
      <li class="post">
        <a href="/free-probabilities/">Free Probabilities</a>
      </li>
    
      <li class="post">
        <a href="/shake-generated-files/">Shake: Generated Files</a>
      </li>
    
      <li class="post">
        <a href="/shake-linting/">Shake: Linting and Formatting</a>
      </li>
    
      <li class="post">
        <a href="/shake-the-intro/">Shake: The Intro</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mavnn">@mavnn</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mavnn',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - mavnn -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'https://blog.mavnn.co.uk/advent-2017-reading-from-the-firehose-with-fable/';
        this.page.identifier = 'https://blog.mavnn.co.uk/advent-2017-reading-from-the-firehose-with-fable/';
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://mavnn.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>






  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
 (function() {
   const searchbox = document.getElementById("searchbox");
   const site_query = document.getElementById("site_query").value;
   const search_query = document.getElementById("search_query");

   searchbox.onsubmit = function() {
     const q = encodeURIComponent(search_query.value);
     document.location.assign("https://google.com/search?q=" + site_query + "+" + q);
     return false;
   };
 })()
</script>


</body>
</html>
