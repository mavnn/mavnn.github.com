<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Mavnn's blog]]></title>
  <link href="http://blog.mavnn.co.uk/atom.xml" rel="self"/>
  <link href="http://blog.mavnn.co.uk/"/>
  <updated>2013-07-09T17:17:17+01:00</updated>
  <id>http://blog.mavnn.co.uk/</id>
  <author>
    <name><![CDATA[mavnn]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Useful find: a decent Windows console]]></title>
    <link href="http://blog.mavnn.co.uk/useful-find-a-decent-windows-console/"/>
    <updated>2013-07-09T16:12:00+01:00</updated>
    <id>http://blog.mavnn.co.uk/useful-find-a-decent-windows-console</id>
    <content type="html"><![CDATA[<p>New machine, new Octopress set up. On Windows, no less.</p>

<p>So let&#8217;s hope a blog post actually appears!</p>

<p>Just in case it does, I&#8217;ll include a useful piece of side
info - a actually decent Windows console called ConEmu.</p>

<p>I&#8217;ll leave you with <a href="http://www.hanselman.com/blog/ConEmuTheWindowsTerminalConsolePromptWeveBeenWaitingFor.aspx">Scott Hanselman&#8217;s excellent review</a>.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coding Hygiene: Moving from project references to NuGet dependencies]]></title>
    <link href="http://blog.mavnn.co.uk/coding-hygiene-moving-from-project-references-to-nuget-dependencies/"/>
    <updated>2013-03-08T17:08:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/coding-hygiene-moving-from-project-references-to-nuget-dependencies</id>
    <content type="html"><![CDATA[<p>So, first post with the new blogging engine. Let&#8217;s see how it goes.</p>

<p>Our code base at <a href="http://15below.com">15below</a> started it&#8217;s life a fair
while ago, well before any form of .NET package management became
practical. Because of that, we ended up building a lot of code in
&#8216;lockstep&#8217; with project references in code as there was no sensible way
of taking versioned binary dependencies.</p>

<p>That&#8217;s fine and all, but it encourages bad code hygiene: rather than
having sharply defined contracts between components, if you&#8217;ve got them
all open in the same solution it becomes far too tempting to just nudge
changes around as it&#8217;s convenient at the time. Changes can infect other
pieces of code, and the power of automatic refactoring across the entire
solution becomes intoxicating.</p>

<p>The result? It becomes very hard to do incremental builds (or
deployments, for that matter). This in turn makes for a long feed back
cycle between making a change, and being able to see it rolled out to a
testing environment.</p>

<p>So as part of the ongoing refactoring that any long lived code base needs to
keep it maintainable and under control, we&#8217;ve embarked on the process of
splitting our code down into more logically separated repositories that
reference each other via NuGet. This will require us to start being much
more disciplined in our <a href="http://semver.org">semantic versioning</a> than we
have been in the past, but will also allow us to build and deploy
incrementally and massively reduce our feed back times.</p>

<p>As part of splitting out the first logical division (I&#8217;d like to say
<a href="http://en.wikipedia.org/wiki/Domain-driven_design">domain</a> but we&#8217;re
not there yet!), I created the new repository and got the included
assemblies up and building on TeamCity. It was only then (stupidly) that
I realised that we had several hundred project references to these
assemblies in our code. There was no way I was going to update them all
by hand, so after a few hours development we now have a script for
idempotently updating a project reference in a [cs|vb|fs]proj file to a
NuGet reference. It does require you to do one update manually first;
especially with assemblies that are strongly signed, I chickened out of
trying to generate the reference nodes that needed to be added
automatically. The script also makes sure that you end up with a
packages.config file with the project that includes the new dependency.</p>

<p>It should be noted that this script has only seen minimal testing, was
coded up for one time use and does not come with a warranty of any kind!
Use at your own risk, and once you understand what it&#8217;s doing. But for
all that, I hope you find it useful.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#r "System.Xml.Linq"
</span><span class='line'>#r "tools\FAKE\FakeLib.dll"
</span><span class='line'>open System.IO
</span><span class='line'>open System.Xml
</span><span class='line'>open System.Xml.Linq
</span><span class='line'>open System.Xml.XPath
</span><span class='line'>open Fake
</span><span class='line'>
</span><span class='line'>// You'll want to replace these values...
</span><span class='line'>let nugetId = "my.package.id"
</span><span class='line'>let refName = "my.ref.name"
</span><span class='line'>let packageNode = XElement.Parse """&lt;package id="my.package.id" version="1.0.0.6" targetFramework="net40" /&gt;"""
</span><span class='line'>let refXml =
</span><span class='line'>    """
</span><span class='line'>    &lt;Reference Include="my.ref.name"&gt;
</span><span class='line'>      &lt;HintPath&gt;..\..\packages\my.package.id.1.0.0.6\lib\net40\my.ref.name.dll&lt;/HintPath&gt;
</span><span class='line'>      &lt;Private&gt;True&lt;/Private&gt;
</span><span class='line'>    &lt;/Reference&gt;
</span><span class='line'>    """
</span><span class='line'>let hintPathFromRoot =
</span><span class='line'>@"packages\my.package.id.1.0.0.6\lib\net40\my.ref.name.dll"
</span><span class='line'>let sourceRoot = "C:\WhereIKeepMyRepo"
</span><span class='line'>
</span><span class='line'>// You should be able to leave the rest alone
</span><span class='line'>let ns = "http://schemas.microsoft.com/developer/msbuild/2003"
</span><span class='line'>let nsm = new XmlNamespaceManager(new NameTable())
</span><span class='line'>nsm.AddNamespace("ns", ns)
</span><span class='line'>let nugetPath = sourceRoot @@ "tools" @@ "NuGet" @@ "NuGet.exe"
</span><span class='line'>
</span><span class='line'>let HasProjectReference (projDoc : XDocument) refName =
</span><span class='line'>    projDoc.Root.XPathSelectElements("//ns:ProjectReference[ns:Name='" + refName + "']", nsm)
</span><span class='line'>    |&gt; Seq.length
</span><span class='line'>    |&gt; (&lt;) 0
</span><span class='line'>
</span><span class='line'>let GetProjectReference (projDoc : XDocument) refName =
</span><span class='line'>    projDoc.Root.XPathSelectElement("//ns:ProjectReference[ns:Name='" + refName + "']", nsm)
</span><span class='line'>
</span><span class='line'>let DeleteProjectReference refName (projFile : string) =
</span><span class='line'>    let projDoc = XDocument.Load(projFile)
</span><span class='line'>    if HasProjectReference projDoc refName then
</span><span class='line'>        let ref = GetProjectReference projDoc refName
</span><span class='line'>        ref.Remove()
</span><span class='line'>        projDoc.Save(projFile)
</span><span class='line'>
</span><span class='line'>let HasReference (projDoc : XDocument) refName =
</span><span class='line'>    projDoc.Root.XPathSelectElements("//ns:Reference[@Include='" + refName + "']", nsm)
</span><span class='line'>    |&gt; Seq.append &lt;| projDoc.Root.XPathSelectElements("//ns:Reference[@Include[starts-with(., '" + refName + ",')]]", nsm)
</span><span class='line'>    |&gt; Seq.tryPick (fun e -&gt; Some e)
</span><span class='line'>
</span><span class='line'>let FirstReference (projDoc : XDocument) =
</span><span class='line'>    projDoc.Root.XPathSelectElements("//ns:Reference", nsm)
</span><span class='line'>    |&gt; Seq.head
</span><span class='line'>
</span><span class='line'>let GetHintPath hintPathFromRoot root projFile =
</span><span class='line'>    let rootDir = DirectoryInfo(root)
</span><span class='line'>    let projDir = DirectoryInfo(Path.GetDirectoryName(projFile))
</span><span class='line'>    let rec dirDiff (rootDir : DirectoryInfo) (currentDir : DirectoryInfo) levels =
</span><span class='line'>        if rootDir.FullName = currentDir.FullName then
</span><span class='line'>            levels
</span><span class='line'>        else
</span><span class='line'>            dirDiff rootDir (currentDir.Parent) (levels + 1)
</span><span class='line'>    hintPathFromRoot::[for _ in 1..(dirDiff rootDir projDir 0) -&gt; ".."]
</span><span class='line'>    |&gt; List.rev
</span><span class='line'>    |&gt; List.fold (@@) "."
</span><span class='line'>
</span><span class='line'>let UpdateHintPath projFile =
</span><span class='line'>    let ref = XElement.Parse(refXml)
</span><span class='line'>    let xs = XNamespace.Get(ns)
</span><span class='line'>    let el = ref.XPathSelectElement("//HintPath")
</span><span class='line'>    el.SetValue (GetHintPath hintPathFromRoot sourceRoot projFile)
</span><span class='line'>    for node in ref.DescendantsAndSelf() do
</span><span class='line'>        node.Name &lt;- xs + node.Name.LocalName
</span><span class='line'>    ref
</span><span class='line'>
</span><span class='line'>let EnsureReference refName (projFile : string) =
</span><span class='line'>    let doc = XDocument.Load(projFile)
</span><span class='line'>    match HasReference doc refName with
</span><span class='line'>    | Some el -&gt; el.Remove()
</span><span class='line'>    | None -&gt; ()
</span><span class='line'>    let el = FirstReference doc
</span><span class='line'>    el.AddBeforeSelf(UpdateHintPath projFile)
</span><span class='line'>    doc.Save(projFile)
</span><span class='line'>
</span><span class='line'>type PackageFile =
</span><span class='line'>    | Exists of string
</span><span class='line'>    | Missing of string
</span><span class='line'>
</span><span class='line'>let GetPackagesDotConfig projFile =
</span><span class='line'>    let dir = Path.GetDirectoryName(projFile)
</span><span class='line'>    let path = dir @@ "packages.config"
</span><span class='line'>    if File.Exists(path) then
</span><span class='line'>        Exists path
</span><span class='line'>    else
</span><span class='line'>        Missing path
</span><span class='line'>
</span><span class='line'>let HasPackageReference (doc : XDocument) nugetId =
</span><span class='line'>    doc.XPathSelectElements("//package[@id = '" + nugetId + "']")
</span><span class='line'>    |&gt; Seq.length
</span><span class='line'>    |&gt; (&lt;) 0
</span><span class='line'>
</span><span class='line'>let EnsurePackagesDotConfigHasPackage nugetId projFile =
</span><span class='line'>    let doc, path =
</span><span class='line'>        match GetPackagesDotConfig projFile with
</span><span class='line'>        | Missing path -&gt;
</span><span class='line'>            XDocument.Parse("&lt;packages /&gt;"), path
</span><span class='line'>        | Exists path -&gt;
</span><span class='line'>            XDocument.Load(path), path
</span><span class='line'>    if not &lt;| HasPackageReference doc nugetId then
</span><span class='line'>        doc.Root.XPathSelectElement("/packages").Add(packageNode)
</span><span class='line'>        doc.Save path
</span><span class='line'>
</span><span class='line'>let UpdateProj (projFile : string) =
</span><span class='line'>    if HasProjectReference (XDocument.Load(projFile)) refName then
</span><span class='line'>        DeleteProjectReference refName projFile
</span><span class='line'>        EnsureReference refName projFile
</span><span class='line'>        EnsurePackagesDotConfigHasPackage nugetId projFile
</span><span class='line'>
</span><span class='line'>!+ (@"**\*.csproj")
</span><span class='line'>++ (@"**\*.fsproj")
</span><span class='line'>++ (@"**\*.vbproj")
</span><span class='line'>|&gt; Scan
</span><span class='line'>|&gt; Seq.map (fun proj -&gt; printfn "Updating %s" proj; proj)
</span><span class='line'>|&gt; Seq.iter UpdateProj</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Throttling the level of concurrency in F#]]></title>
    <link href="http://blog.mavnn.co.uk/throttling-the-level-of-concurrency-in-f/index.html"/>
    <updated>2013-02-15T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/throttling-the-level-of-concurrency-in-f/throttling-the-level-of-concurrency-in-f</id>
    <content type="html"><![CDATA[<div>Async.Parallel |&gt; Async.RunSynchronously is great for running a load of stuff in parallel in F#, as long as you don&#39;t mind them all running at the same time.</div><p /><div>Often, though, you want to map across a sequence and run functions on the elements in parallel, but with a limit to how many are being processed concurrently. Whether you&#39;re doing something CPU heavy and there&#39;s no point running more than the number of processors on the box, or whether you know that you&#39;ll swamp a remote server if you just dump all of your connections on it at once, this issue comes up surprisingly often.</div> <p /><div>As a first stab, you might be tempted to do something like this (if you think like I do):</div><p /><div><script src="https://gist.github.com/4961072.js"></script><br /> </div><p /><div>In a word: don&#39;t. The contention in the Semaphore make this enormously inefficient with even a few hundred tasks.</div><p /><div>In the end, the simplest Â implementation I could come up with that didn&#39;t involve dragging in external dependencies was the following:</div> <p /><div><script src="https://gist.github.com/4961056.js"></script><br /></div><p /><div>If anyone has a simpler implementation, leave a comment and let me know!</div> 
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Fake Part 2: Build and test]]></title>
    <link href="http://blog.mavnn.co.uk/fake-part-2-build-and-test/index.html"/>
    <updated>2013-02-13T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/fake-part-2-build-and-test/fake-part-2-build-and-test</id>
    <content type="html"><![CDATA[<p>The introduction to this series can be found at <a href="http://blog.mavnn.co.uk/getting-started-with-fake-an-introduction-tag">http://blog.mavnn.co.uk/getting-started-with-fake-an-introduction-tag</a> or just check out my Fake tag.</p>
<p><strong>The scenario</strong></p>
<p>So, you&#8217;ve written your brave new F# 3.0 solution, and now you want to build, test and package it with a shared build setup between your CI environment (which, of course, doesn&#8217;t have Visual Studio installed) and your developer&#8217;s machines.</p>
<p><span style="font-size: 13px;">Hopefully this will walk you through most of the potential pitfalls you might find along the way.</span></p>
<p><span style="font-size: 13px;">This post has been written using an actual build.fsx script that we use for a utility project at <a href="http://15below.com" title="15below" target="_blank">15below</a>. We&#8217;re hiring, so if you&#8217;re interested in this kind of thing, drop me a line.</span></p>
<p><strong><span style="font-size: 13px;">Set up</span></strong></p>
<p><span style="font-size: 13px;">There is no installer for the F# 3 compiler, so we&#8217;re going to be playing some games to support building on a TeamCity build agent without VS 2012 installed.</span></p>
<p><span style="font-size: 13px;">The script assumes a few things about your repository:</span></p>
<p>&nbsp;</p>
<ul>
<li><span style="font-size: 13px;">a tools directory with the same NuGet and FSharp directories as at <a href="https://github.com/fsharp/FAKE/tree/develop/tools">https://github.com/fsharp/FAKE/tree/develop/tools</a> (basically a recent nuget.exe in one, and a recent build of the open source F# compiler project in the other)</span></li>
<li><span style="font-size: 13px;">a tools/FAKE directory with a recent build of FAKE (I prefer to have a known version checked into git, but you can read instructions on how to bootstrap it via nuget at <a href="http://www.navision-blog.de/blog/2009/04/01/getting-started-with-fake-a-f-sharp-make-tool/)">http://www.navision-blog.de/blog/2009/04/01/getting-started-with-fake-a-f-sha&#8230;</a></span></li>
</ul>
<p>&nbsp;</p>
<p><span style="font-size: 13px;">From here on down is just a heavily commented build.fsx file. I was going to use FSharp.Formatting to nicely format this, but unfortunately the combination of FSharp.Formatting itself and Posterous have defeated me. Something to play with more at a later date.</span></p>
<p><span style="font-size: 13px;"><script src="https://gist.github.com/4944580.js"></script></span></p>
<p><span style="font-size: 13px;">Hopefully this example will give you a start on using FAKE in real projects.</span></p>
<p><span style="font-size: 13px;">In future posts I&#8217;d like to address some of the more esoteric bits and pieces we&#8217;ve been using FAKE for, such as building Octopus deployment packages, running integration tests (with full setup and database deployment) and running unit tests in parallel. Stay tuned&#8230;</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A short interlude into adaptive polling]]></title>
    <link href="http://blog.mavnn.co.uk/a-short-interlude-into-adaptive-polling-tag-f/index.html"/>
    <updated>2013-01-22T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/a-short-interlude-into-adaptive-polling-tag-f/a-short-interlude-into-adaptive-polling-tag-f</id>
    <content type="html"><![CDATA[<span style="font-family: arial,sans-serif; font-size: 13px;">Your windows service is watching an email inbox.</span><p /> <span style="font-family: arial,sans-serif; font-size: 13px;">How often should it poll?</span><p /><span style="font-family: arial,sans-serif; font-size: 13px;">Once every 5 minutes? Every 10? Then of course you realise that it should be different for every customer&#8230; or maybe every mailbox. You need more config!</span>
<p />
<div>Or not.<p /><span style="font-family: arial,sans-serif; font-size: 13px;">The real answer, of course, is something completely different: it&nbsp;</span><span style="font-family: arial,sans-serif; font-size: 13px;">should poll a lot when a lot of emails are arriving, and not very much&nbsp;</span><span style="font-family: arial,sans-serif; font-size: 13px;">when they aren&#8217;t.</span><p /> <span style="font-family: arial,sans-serif; font-size: 13px;">It took a lot longer than it should have done to get my maths brain&nbsp;</span><span style="font-family: arial,sans-serif; font-size: 13px;">back on, but with the help of my wife I eventually settled on this&nbsp;</span><span style="font-family: arial,sans-serif; font-size: 13px;">code for deciding the intervals between polls:</span><p /> 
<div><script src="https://gist.github.com/4595744.js"></script></div>
<p />
<div>The &#8216;i&#8217; in this function is the number of times we&#8217;ve polled since the last time a new email was received (if one is received, we reset i to 0).</div>
<p />
<div>If you plot this out on a graph, you get something that looks like this:</div>
<p />
<div><img src="http://www.wolframalpha.com/share/img?i=d41d8cd98f00b204e9800998ecf8427ehd954rh40i&amp;f=HBQTQYZYGY4TOM3CGRSGMMBWGAYDCM3DGYZGMOBWGFRDANDCMUZAaaaa" alt="" /></div>
<p />
<div>(You can play with the shape of the graph at Wolfram|Alpha if you&#8217;re feeling really geeky :) -&nbsp;<a href="http://www.wolframalpha.com/share/clip?f=d41d8cd98f00b204e9800998ecf8427ehd954rh40i">http://www.wolframalpha.com/share/clip?f=d41d8cd98f00b204e9800998ecf8427ehd954rh40i</a>&nbsp;).</div>
<p />
<div>This gives us very aggressive polling for the first few minutes after discovering an email, then dropping off rapidly to close to the one every ten minutes mark that I decided was a reasonable background polling rate.</div>
<p />
<div>It&#8217;s not truly adaptive in the machine learning sense, but it gives a very good first cut that is an awful lot better than any fixed value could be.</div>
</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Corrected Error Handling Computational Expression]]></title>
    <link href="http://blog.mavnn.co.uk/corrected-error-handling-computational-expres/index.html"/>
    <updated>2013-01-18T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/corrected-error-handling-computational-expres/corrected-error-handling-computational-expres</id>
    <content type="html"><![CDATA[<p>I&rsquo;ve been wanting to write code like this in F#, and know that any
exceptions within a bound expression in an audit { } block will not
only get caught, but that an external auditing service will get
notified that the operation has failed.</p>

<p><script src="https://gist.github.com/4565937.js"></script></p>

<p>Unfortunately, it turns out my code in my post on error handling
( <a href="http://blog.mavnn.co.uk/playing-with-error-handling-strategies">http://blog.mavnn.co.uk/playing-with-error-handling-strategies</a> ) was
flawed in its ability to handle errors. The irony has not escaped me.</p>

<p>The issue is with the eager evaluation of arguments to the TryFinally
method of the builder. If it takes you a while to work out what that
means, don&rsquo;t worry: it took me about 2 days to wrap my head round it
and work out how to correct the code to make it behave as I would have
expected.</p>

<p>To make things work correctly, the type returned by the computational
expression pretty much has to be a deferred function of some kind.</p>

<p>So, the Interface, now renamed IAuditBuilder, gains a couple of helper
functions and becomes:</p>

<p><script src="https://gist.github.com/4565812.js"></script></p>

<p>The implementation of the TestAuditBuilder (only logs to console on
error) becomes:</p>

<p><script src="https://gist.github.com/4565838.js"></script></p>

<p>So: many thanks to Johann Deneux for patiently pointing out to me what
the flaw in the original code was. I hope this example of a lazy
computational expression is useful to other starting out down this
rabbit hole of monadic weirdness. At least the resulting code looks
pretty nice and readable now that the builder is fixed.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[In Which Our Intrepid Author De-sugars a Monad by Hand]]></title>
    <link href="http://blog.mavnn.co.uk/in-which-our-intrepid-author-de-sugars-a-mona/index.html"/>
    <updated>2013-01-16T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/in-which-our-intrepid-author-de-sugars-a-mona/in-which-our-intrepid-author-de-sugars-a-mona</id>
    <content type="html"><![CDATA[<p>In my previous post ( <a href="http://blog.mavnn.co.uk/playing-with-error-handling-strategies">http://blog.mavnn.co.uk/playing-with-error-handling-strategies</a> ), Johann Deneux asked me whether my implementation of TryFinally actually worked. <p /> TD;LR: It works. But thank you Johann for making me check!</p>
<p>Editted TD;LR: It&#8217;s broken, but not for the reason I thought. See the comments for details, and corrected code here&nbsp;<a href="http://blog.mavnn.co.uk/corrected-error-handling-computational-expres">http://blog.mavnn.co.uk/corrected-error-handling-computational-expres</a><p /> This gave me a bit of a pause, as it&#8217;s actually an implementation I took from another source. One I trust, but it was still embarrassing to realise I couldn&#8217;t answer this question with full confidence as I didn&#8217;t quite understand the code myself. <p /> In the end (especially given I&#8217;m planning to actually use this code in production at some point), I decided to go the whole hog and de-sugar a couple of simple versions of the computational expression. <p /> So, first, the audit monad as used in my example code from the last post with just a simple let binding: <p /> <script src="https://gist.github.com/4550342.js"></script><p /> This raised my confidence slightly - the code I&#8217;d written did what I expected. But, what happened when I tried to bind a disposable resource using use! rather than let!? Time for the moment of truth: <p /> <script src="https://gist.github.com/4550496.js"></script><p /> So there you have it. The code does actually behave as expected, protecting the use of the disposable resource and ensuring it&#8217;s disposal. And I can breath easy that my code is doing what I thought it should be. Hopefully this will also serve as a useful example for anyone else starting out on the happy road of using computational expressions.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Playing with error handling strategies]]></title>
    <link href="http://blog.mavnn.co.uk/playing-with-error-handling-strategies/index.html"/>
    <updated>2013-01-14T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/playing-with-error-handling-strategies/playing-with-error-handling-strategies</id>
    <content type="html"><![CDATA[<p>Taking a break from Fake for a moment (I&#8217;ll get back to it, I promise!) <p /> Note: this post assumes a basic understanding of computation expressions in F#; if you&#8217;re looking for a primer on them,&nbsp;<a href="http://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions">http://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions</a> <br />is a good place to start.</p>
<p>Note 2: the code in this post is actually broken if you use a use! or try finally block within your audit block. Check out&nbsp;<a href="http://blog.mavnn.co.uk/corrected-error-handling-computational-expres" style="font-size: 13px;">http://blog.mavnn.co.uk/corrected-error-handling-computational-expres</a>&nbsp;for the corrected code.</p>
<p><br />I had a series of small services I needed to add error handling to today to polish them up from nice clean prototype to production ready status. <p /> Thinking about the joys of re-implementing the same error handling strategy in each of them, it occurred to me that this was exactly the kind of thing that computational expressions were built for. But my requirements went a bit further than just log the error and continue: each of these services contain critical locations where if a error occurred, we didn&#8217;t just want it logged locally, but we wanted (in some cases) an alert sent to a remote auditing* server. <p /> Of course, mocking out the auditing service for testing is a bit of a pain in the backside, and how auditing is achieved shouldn&#8217;t really be the responsibility of these services anyway. <p /> So, I decided to experiment with a builder interface. <p /> Meet the IErrorHandlerBuilder interface: <p /> <script src="https://gist.github.com/4533440.js"></script><p /> Should look awfully familiar if you&#8217;ve recently checked out the msdn page on computational expressions: <a href="http://msdn.microsoft.com/en-us/library/dd233182.aspx">http://msdn.microsoft.com/en-us/library/dd233182.aspx</a> (except, you know, mine has the right signatures; that might want to be fixed at some point). <p /> How do we use it? <p /> Well, first we need an implementation. In fact, let&#8217;s have two. Our first candidate, the AuditBuilder, takes an unhealthy number of dependencies that (in turn) take an unhealthy number of dependencies that you almost certainly want to supply from an IoC container. <p /> <script src="https://gist.github.com/4533554.js"></script><p /> What does it do? Well, basically if any bound function throws it logs the error via log4net and our in house audit server and then returns None. Otherwise it returns Some result from the computation. Obviously, if a computation further up the chain has already thrown we already have a None and we just pass it along. TryFinally and Using are implemented to make sure that you can still use disposable resources as you would expect within the expression. <p /> Our second candidate is the TestErrorBuilder: <p /> <script src="https://gist.github.com/4533560.js"></script><p /> This is almost identical to the implementation above, except that it takes no dependencies at all and if there is an error it just logs to the console via printfn. Very useful for debugging - you might even want a unit test version that logs nothing, depending on your unit tests. <p /> And now, our preparation is complete. How do we use our new toy, you ask? <p /> Something like this: <p /> <script src="https://gist.github.com/4533619.js"></script><p /> This little service persists interesting email messages to a document store, and sends the contents back to you when you request them. If an email is not persisted, or a request for an email fails, we want a remote alert to be triggered in production. Both the persist and content requests are handled as RabbitMq messages (using the EasyNetQ client). <p /> So in the message handler callbacks, declare an audit { } block and let! bind our message. Then we simply pass that bound message on to a handling function or object and return the resulting value, safe in the knowledge that our hosting program will have supplied an appropriate IErrorHandlerBuilder for our current purposes. The beauty of all of this is that the service object does not need to know what the error handling strategy is, and the objects/functions doing the work do not need to worry about error handling at all. <p /> This technique is especially useful in situations where you are making use of asynchronous programming techniques such as agents and you really don&#8217;t want a single failure taking out your whole agent or async expression. If for some reason it&#8217;s important to your code what the error is, as well as knowing it&#8217;s been handled, it would be easy to modify this technique to return a Choice or custom MaybeError discriminated union that you could pull the exception out of later. <p /> It would also be helpful for managing things like SQL connections with multiple retry attempts: for testing you may not want that kind of complexity and you could pass in a simpler strategy builder, while testing your robust, multiple retry computational builder for use in actual deployed environments (test or production). <p /> And, of course, just knowing that builder interfaces are possible raises up a whole new world of possibilities. <p /> As always, I tend to write about stuff that is fresh and new to me (i.e. not fully considered and maybe fatally flawed). Comments and suggestions welcome. <p /> * To avoid any confusion, I should note that the word audit is used loosely in this blog post, with a meaning more related to a namespace within our code than the normal meaning of the word &#8216;audit&#8217;.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Getting started with Fake - an introduction]]></title>
    <link href="http://blog.mavnn.co.uk/getting-started-with-fake-an-introduction-tag/index.html"/>
    <updated>2013-01-09T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/getting-started-with-fake-an-introduction-tag/getting-started-with-fake-an-introduction-tag</id>
    <content type="html"><![CDATA[<blockquote><p>This is the first post in what will be a series about how we moved to
using <a href="https://github.com/fsharp/FAKE">Fake</a> for our build and testing
at <a href="http://15below.com">15below</a>. Feel free to follow along for the
ride. It&rsquo;s partly there as a way of keeping the full development group
within the company informed of what&rsquo;s going on, so it will get pretty
detailed and gritty in the later sections, but we decided that there
wasn&rsquo;t anything too company specific in here. So we&rsquo;re sharing it with
you all&hellip;</p></blockquote>

<p>At my current employer, we have a wide range of code all the way from
automatically translated vb6 (to vb.net) to brand spanking new F# and
C#. At the end of the day though, everything runs on .net 4.0
(currently).</p>

<p>With the newer components, we could in theory be building and testing
them independently: messaging based and developed in a TDD style they
tend to have an existing test harness around them and be easy to add
further tests to if it proves necessary.</p>

<p>The legacy code on the other hand, is a bit of a different matter.
It&rsquo;s still in the code base because it works. We know it works,
because customers are using it and getting value from it. The bits
that didn&rsquo;t, or looked like they were getting flaky, are the bits that
have been refactored as we went along. But they are old enough that
what is now considered basic testing hygiene was still a little more
than a twinkle in Kent Beck&rsquo;s eye. (Ok, ok, so the book had been
released. But it wasn&rsquo;t exactly considered common best practice yet).
So until the refactoring work is complete, we&rsquo;re stuck with a system
where the only feasible way of testing some aspects of it is to
actually deploy it somewhere and run some jobs through.</p>

<p>So what does this all have to do with Fake?</p>

<p>Well, basically our continuous integration was getting out of control.
To get the level of functionality and control we needed, we were
ending up with somewhere in the region of 500 lines of re-entrant,
recursive MsBuild scripts. I seriously considered starting the
alt.ms.build.die.die.die newsgroup. A full build on a developer&rsquo;s
machine could take upwards of 45 minutes. Even more painfully, as the
refactoring continued we ended up with TeamCity build configurations
tightly coupled to specific versions of our software, and it was
becoming clear that the whole CI system was going to rapidly collapse
under it&rsquo;s own weight unless things changed.</p>

<p>We needed a solution.</p>

<p>It had to be:</p>

<ul>
<li>Powerful. Programming in MsBuild is&hellip; not fun. Xml is for data.</li>
<li>Storable in git along with our source code.</li>
<li>.net based. We&rsquo;re a .net shop, and our specialist knowledge is .net;
rake wasn&rsquo;t going to cut it. We also didn&rsquo;t want the management
overhead of even more tooling on the build agents.</li>
<li>In active development.</li>
<li>Preferably open source, so even if external development stopped we
could continue to maintain it.</li>
</ul>


<p>As both the company F# evangelist and one of the two people doing most
of the CI work, I was very interested to hear about Fake, especially
after having a chance to chat to it&rsquo;s author (<a href="https://twitter.com/sforkmann">Steffen
Forkmann</a>) and having it recommended by
Don Syme (who wrote F#).</p>

<p>It met all of the criteria above. It&rsquo;s scripts are full F# &ndash; a
language fully supported by Microsoft within it&rsquo;s flagship Visual
Studio product. The scripts can easily be stored in git. It&rsquo;s actively
being worked on, and accepting contributions as a fully open source
product.</p>

<p>Time to give it a try.</p>

<p>Next post: how to set up your &ldquo;HelloWorld.fsx&rdquo; Fake script with your
source, with all the niceties like intellisense that you would want.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[St. Lambda and the T-shirt of Extra Geek]]></title>
    <link href="http://blog.mavnn.co.uk/st-lambda-and-the-t-shirt-of-extra-geek/index.html"/>
    <updated>2013-01-04T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/st-lambda-and-the-t-shirt-of-extra-geek/st-lambda-and-the-t-shirt-of-extra-geek</id>
    <content type="html"><![CDATA[<p>Possibly my geekiest self Birthday present ever: the #NOOO! manifesto (<a href="http://notonlyoo.org">http://notonlyoo.org</a>) t-shirt, personalized with membership number (and a !).</p> <p>I&#39;m not exactly a fashion model, but I was asked for pictures, so there you go. My wife also appears to have decided I needed to be backlit for the St. Lambda effect&#8230;</p> <p>Given the nature of the manifesto (&#39;Options over nulls&#39;) I was especially amused to see note the fact that whatever software they&#39;re using for the packing skips handles blank lines incorrectly and print &#39;null&#39; instead. Check the back text confirmation in the third picture.</p> <p><img src="http://blog.mavnn.co.uk/images/IMAG0232-1.jpg" alt="St. Lambda and the T-shirt of Extra Geek" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Dealing with grief]]></title>
    <link href="http://blog.mavnn.co.uk/losing-an-unborn-child/index.html"/>
    <updated>2012-12-23T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/losing-an-unborn-child/losing-an-unborn-child</id>
    <content type="html"><![CDATA[<div>About 2 weeks ago, our unborn child died. We found out on Thursday (20/12/2012).</div>
<p />
<div>I&#8217;ve written this as a blog post: I&#8217;m not sure why, as I&#8217;m not sure that I&#8217;ll ever publish it. But if I do, and you&#8217;re normally here to read the technobabble, and you don&#8217;t care about the emotional stuff, the sentence above is probably all you need to know. One of the reasons this might get published is that I really don&#8217;t want to have to tell everyone about it in person.</div>
<p />
<div>As of Thursday morning, all seemed to be going well with the pregnancy. &nbsp;That morning was the primary school play; the afternoon was the midwife &#8216;just in case&#8217; check.</div>
<p />
<div>Roll back one: there is a medical history here that meant this was considered a high risk pregnancy. Hence the regular checks. &nbsp;</div>
<p />
<div>School finished at lunch for the last day before the Christmas break, and we were out of the &#8216;danger zone&#8217; first 12 weeks, so older brother went along with Mamma to hear the heart beat. There wasn&#8217;t one. I&#8217;m working from home, and it&#8217;s nearly dinner time, so we grab some food and all 3 of us go to the hospital. There&#8217;s no one who can provide child care on such short notice even if we want it, and there is absolutely zero chance I&#8217;m sending my wife on her own.</div>
<p />
<div>Roll back two: we already knew that at this point (~15 weeks into the pregnancy) it&#8217;s not always possible to hear the heart beat with the equipment available to the midwife. But she had managed to hear the heartbeat 2 weeks earlier. So I&#8217;m worried, but still hoping that this is hassle rather than something actually having gone wrong.</div>
<p />
<div>Aside: Maternity triage is a strange place, directly attached to the maternity ward. So you sit and wait (not a massive amount of time in the grand scheme of things) watching the really heavily pregnant people right at the end of the process go past. This is a strange, and not especially comforting experience. For bonus points I suspect a lot of the people who&#8217;s pregnancies have gone smoothly don&#8217;t even know what the triage area is. You get some strange looks sitting there with someone who obviously isn&#8217;t ready to give birth; as if as a man you need the reason to be there of someone giving birth or else you&#8217;re some kind of weird alien invader into the space.</div>
<p />
<div>The doctor who saw us was thorough, sympathetic and direct. It&#8217;s pretty obvious from the ultra sound that things are not good; even as a layman I&#8217;ve seen enough scans that it&#8217;s immediately apparent the baby isn&#8217;t alive. The only thing the doctor can add is that it isn&#8217;t recent; there are signs that I wouldn&#8217;t have spotted that the baby had been dead for some time.</div>
<p />
<div>&#8212;&#8212;&#8212;&#8212;</div>
<p />
<div>We spent Friday in hospital dealing with the medical side of the process which was harrowing but complete. My wife&#8217;s physical health is fine apart from tiredness and soreness that seem to be steadily returning to normal. My family and my work were both fantastic: I work in the same office as my brother at the moment, and they had no problem with both of us just disappearing. He stayed with our son (along with my parents and niece for a good chunk of the day) while we were at hospital. I&#8217;m amazingly grateful for the flexibility and availability of people: it was brought home to me even further when my Dad at one point, as an aside, checked if I&#8217;d been able to get time off to be at the hospital and I realised that when my parents went through a very similar experience in the 70s that probably was not a given.</div>
<p />
<div>So&#8230; physically that&#8217;s it. Done. Of course, in reality, it&#8217;s not that simple. &nbsp;When my grandfather passed away, I learnt something pretty important about myself, that has stayed with me ever since: I can freely mix joy and sorrow in life in ways that most people seem to find hard, or even distasteful. I&#8217;m not sure if this is a gift, or a minor insanity, but it&#8217;s definitely very helpful as life doesn&#8217;t tend to come in nice discriminated good and bad packages. So here I am, in mourning while celebrating advent. Frequently in tears (lesson number 2 from grandfather passing away: I realised I needed to learn to cry. It took a long time to learn), yet genuinely looking forward to going to the candle lit carols with the family. Feeling the heart ache of this person I&#8217;ll never know while checking out my son&#8217;s Christmas present that just arrived in the post. &nbsp;Wondering how I&#8217;m ever going to put this stuff into words, whilst making fun of myself across the internet as I try to drink my espresso with salt instead of sugar (by mistake, obviously&#8230;). &nbsp;And it&#8217;s hard, because it&#8217;s all real; but it doesn&#8217;t feel it. In the same way that when you find out that there&#8217;s a child on the way, there&#8217;s always a bit of a feel of unreality to it (you don&#8217;t know what they&#8217;re going to be like, there&#8217;s no signs of the pregnancy yet, etc), when you find out that they&#8217;re not on the way that feels pretty unreal too. &nbsp;Except that it&#8217;s not: they&#8217;re really gone, and we really got to see them, and when the sadness comes it&#8217;s not unreal at all.</div>
<p />
<div>It&#8217;s a mix of bereavement and the opportunity not taken. The sadness of a missing loved one mixed with the &#8216;what if&#8217; of not pushing the open door. Because however much you know there&#8217;s nothing that you could have done, this is still someone you were the guardian of. Even if you couldn&#8217;t guard them yet: I don&#8217;t feel guilt, as if I should have saved them. But it does feel as if&#8230; something. &nbsp;As if there should have been an option I could have taken to protect them. I&#8217;m at peace that there wasn&#8217;t: but not that there shouldn&#8217;t have been. &nbsp;And there&#8217;s a whole medley of other things flying around as well: how awesome my immediate family have been, with my 5 year old doing everything he knows how to offer support and be as considerate as he knows how. My incredible wife, who somehow impossibly has managed to let herself start grieving without falling apart. My family who have stepped in and mostly just been available, and just done what we asked without trying to &#8216;save the day&#8217; or take over.</div>
<p />
<div>And a special shout out to the new church. They have been wonderful as a safe place, and a comfort and a source of peace. No one&#8217;s tried to fix it, or tell us it&#8217;s all ok. No one has tried to step in and be the hero. &nbsp;But they&#8217;ve been with us, and prayed with us. They dropped off flowers at the flat while we were still at the hospital. They took me off the rota I was due to be on for Sunday before I had to ask (I didn&#8217;t get the message in time so asked anyway, but hey ho!). &nbsp;They came and *actually spoke to us* about things. No prying, no pushing just the honest &#8220;how are you doing?&#8221; that actually expects an answer. With discretion, and care, but they made sure that as many people as possible who had known we were expecting knew the news without us having to go to everyone and tell them. And they came to both of us, not just my wife; just to make sure that I wasn&#8217;t being ignored just because I&#8217;m &#8216;the man&#8217;.</div>
<p />
<div>Two things in particular I&#8217;ll treasure for a long time out of all of this. One is my wife saying on the way to church that after the service she was going to seek out two particular ladies and ask them to pray with and support her: and at the end of the service the two of them being there before she had a chance to stand up. &nbsp;And the pastor, who had been ill in the morning and so hadn&#8217;t heard the news. We saw him before the evening carols, and he asked my wife how things were going. &nbsp;She told him, and with the service about to start, and about 400 people waiting for him he just stopped, grabbed us in a hug and cried (while praying for us). It was, I think, the single most therapeutic thing anyone has ever done for me.</div>
<p />
<div>So I cry, and smile. And I mean them both.</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Anyone Using FsCheck for Business Code?]]></title>
    <link href="http://blog.mavnn.co.uk/anyone-using-fscheck-for-business-code/index.html"/>
    <updated>2012-12-13T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/anyone-using-fscheck-for-business-code/anyone-using-fscheck-for-business-code</id>
    <content type="html"><![CDATA[<p>Libraries like FsCheck ( <a href="http://fscheck.codeplex.com/">http://fscheck.codeplex.com/</a> ) andÂ  Pex always capture my imagination as fantastically clever and potentially useful tools. Along with things like strong type systems and code contacts they especially appeal to my long buried mathematical background.</p> <p>Unfortunately, and probably because of said mathematical background, I sometimes struggle to think of ways to use them outside of maths and science problems. If I&#39;m working on a maths library or I decide I want to write a sorting algorithm, trivially easy sanity checks of things like whether a function is cummutative or associative are immediately useful.</p> <p>If I&#39;m writing a service that polls an email address for bounced emails and out of office replies&#8230; I don&#39;t know. It feels like there should be things they can help me with: after all, over the years I&#39;ve decided the strong type system is helpful even for this side of things, so surely the QuickCheck/proof side of things should be to. But the amount of work it requires to set up the test generators for complex data types (and then trying to formalize the acceptance criteria without just writing the actual implementation!) feels so large compared to the size of the project that I can never justify the time to actually use the tools.</p> <p>So I&#39;m left wondering: am I missing something? Is there a whole new level of treating ease and vigour I&#39;m missing out on just because I don&#39;t have the imagination and experience to make good use of the tools right there in front of me? </p> <p>Or are these tools only really useful in their own narrow field? </p> <p>I suspect the middle ground; for the moment ideas are avoiding me in droves. Any good open source examples out there of these tools in use for the kind of &#39;business&#39; code that most of us spend most of our time writing? </p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Strange errors from the F# compiler]]></title>
    <link href="http://blog.mavnn.co.uk/strange-errors-from-the-f-compiler/index.html"/>
    <updated>2012-11-23T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/strange-errors-from-the-f-compiler/strange-errors-from-the-f-compiler</id>
    <content type="html"><![CDATA[I found a new error, yesterday:<p /><div>Â  Â Â <i class="" style="font-style: normal; background-color: rgb(245,245,245); font-family: Menlo,Bitstream Vera Sans Mono,Courier New,Courier,monospace; font-size: 12px; line-height: 16.78333282470703px; color: rgb(196,112,3);">error FS0192: internal error: null: GetTRefType</i></div> <p /><div>It showed up when I tried to run a .fsx script that referenced NuGet.Core 2.1.0, but only when the script was run on Windows Server 2008 R2. Windows 7 x64? No problems. Windows Server 2003/8 x86? No problems.<br /> </div><p /><div>2008 R2? Bam. Every time.</div><p /><div>A bit of trial of error discovered two things:</div><p /><div>The error went away if I referenced NuGet.Core 2.2.0 alpha 4<br /></div><p /><div>And the minimal error case is pretty minimal:</div><p /><div><script src="https://gist.github.com/4136322.js"></script></div><p /><div>Looking at the NuGet.Core source ( <a href="http://nuget.codeplex.com/SourceControl/changeset/view/5b6d7e16b19c#src%2fCore%2fSemanticVersion.cs">http://nuget.codeplex.com/SourceControl/changeset/view/5b6d7e16b19c#src%2fCore%2fSemanticVersion.cs</a> ) the only thing that might be a relevant change that I can see is a simplification of some custom GetHashCode logic.</div> <p /><div>Raising the interesting question of why there is custom GetHashCode logic in the first place, and how the heck did they get it to cause internal F# compiler errors anyway? And why did it only fail on that one specific version of Windows?</div> <p /><div>All very strange. Hopefully 2.2.0 will be a full release before we want to start using this technique for in our production code!Â </div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Some days it's good to be a dad]]></title>
    <link href="http://blog.mavnn.co.uk/some-days-its-good-to-be-a-dad/index.html"/>
    <updated>2012-11-17T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/some-days-its-good-to-be-a-dad/some-days-its-good-to-be-a-dad</id>
    <content type="html"><![CDATA[<p>Although you do get proud of some of the strangest things. I particularly like the Welsh dragon.</p> <p>What you can&#39;t see is that he&#39;s written the names of each country on the back of the respective flag.</p> <p><img src="http://blog.mavnn.co.uk/images/IMAG0158.jpg" alt="Some days it's good to be a dad" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Representing EasyNetQ Message Subscriptions as Blocking Queues]]></title>
    <link href="http://blog.mavnn.co.uk/representing-easynetq-message-subscriptions-a/index.html"/>
    <updated>2012-11-15T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/representing-easynetq-message-subscriptions-a/representing-easynetq-message-subscriptions-a</id>
    <content type="html"><![CDATA[<p><span style="color: #222222; font-family: arial, sans-serif;">EasyNetQ (</span><a href="https://github.com/mikehadlow/EasyNetQ" target="_blank" style="color: #1155cc; font-family: arial, sans-serif;">https://github.com/mikehadlow/EasyNetQ</a><span style="color: #222222; font-family: arial, sans-serif;">) is a simple wrapper for RabbitMq that allows you to trivially send and receive plain .net objects over the wire (as long as they can be serialized). It handles all the details of setting up exchanges and queues for you, and as long as your use case fits its (deliberately) simple pattern it&#8217;s very convenient.</span></p>
<div style="color: #222222; font-family: arial, sans-serif;">Unfortunately, if you want to use it in a more functional landscape (*cough* from F# *cough*), the fact that it exposes subscriptions via registering a callback is not the ideal interface. In these situations, it&#8217;s much easier to handle (and reason about) a lazy infinite sequence of messages that you can then handle however you want, including in the simplest case just sitting on the sequence in a small tail call recursive function.</div>
<div style="color: #222222; font-family: arial, sans-serif;">So EasyFQ was born. Weighing in at a mighty 16 lines of F# code, it contains one function: SeqSubscibe&lt;&#8217;a&gt; :&nbsp;(IBus -&gt; string -&gt; seq&lt;&#8217;a&gt;).</div>
<div style="color: #222222; font-family: arial, sans-serif;">There&#8217;s a .fsx with example usage in the GitHub repository:&nbsp;<a href="https://github.com/michael-newton-15below/EasyFQ" target="_blank" style="color: #1155cc;">https://github.com/michael-newton-15below/EasyFQ</a></div>
<div style="color: #222222; font-family: arial, sans-serif;">I suppose the next step is to pester Mike into making it a Nuget package under the EasyNetQ umbrella&#8230;</div>
<p>&nbsp;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[An introduction to F# (Screencast and PDF slides)]]></title>
    <link href="http://blog.mavnn.co.uk/an-introduction-to-f-screencast-and-pdf-slide/index.html"/>
    <updated>2012-11-09T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/an-introduction-to-f-screencast-and-pdf-slide/an-introduction-to-f-screencast-and-pdf-slide</id>
    <content type="html"><![CDATA[[[posterous-content:BtdYjh2l4izPGjbyNN4B]]<p>A recent developer education session I gave at 15below.</p><p /><div>This presentation was aimed at a group of C# developers of varying experience.</div><p /><div><iframe src="http://www.youtube.com/embed/obDZcv8ZXog?wmode=transparent" allowfullscreen frameborder="0" height="417" width="500"></iframe></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sending emails via the command line]]></title>
    <link href="http://blog.mavnn.co.uk/sending-emails-via-the-command-line/index.html"/>
    <updated>2012-10-11T00:00:00+01:00</updated>
    <id>http://blog.mavnn.co.uk/sending-emails-via-the-command-line/sending-emails-via-the-command-line</id>
    <content type="html"><![CDATA[Is awesome for html email testing.<p /><div>Thanks to the instructions atÂ <a href="http://znc-mailer.readthedocs.org/en/latest/mail.html">http://znc-mailer.readthedocs.org/en/latest/mail.html</a>Â for getting gmail connections up and running.<br /> <p /></div><div><img src="http://blog.mavnn.co.uk/images/image.png" alt="Sending emails via the command line" /><br /></div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Teaching Good Programming Style]]></title>
    <link href="http://blog.mavnn.co.uk/teaching-good-programming-style/index.html"/>
    <updated>2012-10-09T00:00:00+01:00</updated>
    <id>http://blog.mavnn.co.uk/teaching-good-programming-style/teaching-good-programming-style</id>
    <content type="html"><![CDATA[<p>So, I have several people from technical/mathematical backgrounds who are interested in learning more about programming, specifically with .net in some cases.</p> <p>Tooling is easy; Visual Studio Express, Monodevelop and Sharp Develop are all freely available.</p> <p>The question is, where would you start people off in terms of learning good, solid (see what I did there?) coding practices? Give them small projects and critique? Are there good open source projects for starters to get involved with? </p> <p>Given the intelligence and background of these people, teaching them syntax is the least of my worries: a basic tutorial and Project Euler will have them writing code that works in no time. Most of them even have &#39;toy project&#39; level skills in other programming languages. It&#39;s helping them learn how to build projects that work without falling into all the classic pitfalls of spaghetti code, or at least helping them climb out as quickly as possible.</p> <p>The thing that springs to mind (given there is several people) is to find a real world project that could be split into several &#39;trivial&#39; pieces that would need to communicate with each other; immediate opportunities to teach things like messaging, modularization and IoC (especially with some not very strict TDD built in). After the tutorial/Project Euler stage above, obviously.</p> <p>Suggestions? Other ideas? </p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Stress testing EasyNetQ services with F#]]></title>
    <link href="http://blog.mavnn.co.uk/stress-testing-easynetq-services-with-f/index.html"/>
    <updated>2012-10-04T00:00:00+01:00</updated>
    <id>http://blog.mavnn.co.uk/stress-testing-easynetq-services-with-f/stress-testing-easynetq-services-with-f</id>
    <content type="html"><![CDATA[<div>Having recently moved one of our (<a href="http://15below.com">http://15below.com</a>) infrastructure services from using MSMQs to RabbitMq (via using EasyNetQ:Â <a href="https://github.com/mikehadlow/EasyNetQ">https://github.com/mikehadlow/EasyNetQ</a>), I then wanted to run it through some simple stress tests. One of the reasons for this is that the old service used to time out on messages regularly, leaving them in a dead letter queue and requiring us to write the &#39;DeadLetterProcessor&#39; (a complete service in it&#39;s own right) to deal with the time outs.</div> <p /><div>74 lines of F# later, I was hitting the service with 40,000 requests spread across 4 parallel processes.</div><br /><div><script src="https://gist.github.com/3832369.js"></script></div> <p /><div>And the results: 18 seconds to process the lot, with no time outs or losses. Requests were going in faster than the service could process them, but Rabbit was admirably handling that side of things, and with the new setup multiple copies of the service would automatically round robin requests if that was ever needed.</div> <p /><div>Adious, DeadLetterProcessor: it was nice deleting you&#8230;</div>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[GPL Munitions]]></title>
    <link href="http://blog.mavnn.co.uk/gpl-munitions/index.html"/>
    <updated>2012-06-12T00:00:00+01:00</updated>
    <id>http://blog.mavnn.co.uk/gpl-munitions/gpl-munitions</id>
    <content type="html"><![CDATA[<p>Awesome discussion on the finer points of whether having a Linux based cruise missile launched at you entitles you to a copy of the source code running on it.</p> <p>And whether commando raids are a valid form of delivery&#8230;</p> <p>&#39;US Navy buys Linux to guide drone fleet (The Register) [LWN.net]&#39;</p> <p><a href="http://lwn.net/Articles/501536/">http://lwn.net/Articles/501536/</a></p>
]]></content>
  </entry>
  
</feed>
