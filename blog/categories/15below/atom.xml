<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 15below | Mavnn's blog]]></title>
  <link href="http://blog.mavnn.co.uk/blog/categories/15below/atom.xml" rel="self"/>
  <link href="http://blog.mavnn.co.uk/"/>
  <updated>2015-01-12T13:02:55+00:00</updated>
  <id>http://blog.mavnn.co.uk/</id>
  <author>
    <name><![CDATA[mavnn]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Keeping Up with the Latest Hammer]]></title>
    <link href="http://blog.mavnn.co.uk/keeping-up-with-the-latest-hammer/"/>
    <updated>2014-12-22T12:07:02+00:00</updated>
    <id>http://blog.mavnn.co.uk/keeping-up-with-the-latest-hammer</id>
    <content type="html"><![CDATA[<h2>Making Sure Your Developers Keep Developing</h2>

<p>Software development is a strange profession, mostly because it&rsquo;s so young and because the tools are changing so fast. I&rsquo;ve not been an established enough craftsman in any other trade to know whether other professions are moving as quickly these days, but at least in my imagination once a carpenter learns to use a hammer, it doesn&rsquo;t get discontinued after 2 years and the hammer taken off the market. Or a new hammer released that hammers nails ten times as fast, but has a different
shaped handle and you have to hammer sideways instead of down.</p>

<p>We don&rsquo;t even seem to be able to decide whether it&rsquo;s a craft or a science. You can earn Computer Science degrees &ndash; but then well known software professionals choose titles like <a href="https://twitter.com/unclebobmartin">Software Craftsman</a>.</p>

<p>Despite all of our claims of best practice and shared knowledge, it largely boils down to: developers don&rsquo;t know what they&rsquo;re doing yet. We&rsquo;re a new profession, and we&rsquo;re still learning &ndash; not just as individuals, but as a profession.</p>

<p>This means that both as an individual developers, and as software houses &ndash; if we stop learning, we sink. The competitive advantage of keeping up with what&rsquo;s happening in the industry so outweighs the cost of doing the research that it would be foolish not to. Because while we might not yet know the <em>right</em> way to do things, we&rsquo;re still definitely finding <em>better</em> ways to do things.</p>

<p>So: how do we do keep up to date, as <a href="/keeping-up-with-the-latest-hammer/#individuals">individuals</a> and as <a href="/keeping-up-with-the-latest-hammer/#companies">companies</a>?</p>

<!-- More -->


<h2><a name="individuals"></a> As individuals</h2>

<h3>Books and Blogs</h3>

<p>Firstly of course, you need to read. Technical books are still excellent when you need a deep dive into a specific subject, but in general a lot of the information is now becoming available in blog posts which seem to be developers main method of swapping information, ideas, and &ldquo;best practice&rdquo;. In general, if you need a deep dive into an established technology or you need to read up on a subject at a conceptual level (Test Driven Development, Functional Programming, etc.)
then a book can be very helpful. If you&rsquo;re looking into something new, or very specific (AngularJS, a particular unit testing framework) then it&rsquo;s time to hit google and read up on some blog posts. Otherwise you&rsquo;ll just have a stack of dead trees to be taking to the recycling center every six months.</p>

<h3>Conferences</h3>

<p>Sometimes, there&rsquo;s nothing like seeing somebody do something. Or hearing from someone who&rsquo;s actually done the thing you&rsquo;re thinking of doing.</p>

<p>Conferences come into their own in these situations; large conferences can be nice because of the big name speakers and the wide range of subjects but in my experience small specialist conferences have two big advantages. They give you much more access to the speakers outside the sessions, and they tend to be much cheaper!</p>

<p>Speaking at conferences is a great way to attend them cheaply, and is also a great way of ending up at things like speaker&rsquo;s dinners and making some contacts as well as learning the particular skill you went for. If you or your company is doing something well &ndash; pretty much anything well &ndash; get yourself out there. It provides great opportunities for you, and other people&rsquo;s gratefulness is a currency you can&rsquo;t buy with money.</p>

<p>And&hellip; ssssh, don&rsquo;t tell everyone: it&rsquo;s actually really easy to get speaking gigs at specialist conferences if you know about a relevant specialist subject. Why? Because people like you don&rsquo;t bother applying, and so the organisers tend to be a bit desperate. Yes, you&rsquo;ll need to do some public speaking &ndash; but that&rsquo;s not exactly a bad skill to have under your belt anyway, is it now?</p>

<h3>Research Papers</h3>

<p>Keeping up with computer science research would be a more than full time job in its own right &ndash; but the research that is turning out to have practical applications is often referenced in talks and blog posts by the people who are basing projects off it. If the project looks interesting to you, don&rsquo;t be afraid to go back and read the original research papers! There&rsquo;s generally more in there than the current project needs which might help you even further &ndash; and they are often
surprisingly readable.</p>

<h3>Training Courses</h3>

<p>And for some skills, you just need the hands on training. It can be expensive, but on occasion its worth it to pay your money and actually be taught to do something.</p>

<h3>Discernment</h3>

<p>It&rsquo;s not a word that comes up very often, but discernment is critical to software developers. Remember what I was saying above about it being a new profession? Well, one of the side effects of that is we&rsquo;re still learning from our mistakes and we&rsquo;re still repeating them. Not everything that people say is new is actually new &ndash; try and check back in the (relatively short) history of computer science to see if it&rsquo;s already been tried and failed.</p>

<p>A classic example of this is distributed computing; making lots of computers do lots of things at the same time is actually pretty hard to get right. A lot of the &ldquo;new&rdquo; solutions to the problem you see being suggested are actually ideas that people have already tried and do not work; if you need to work with distributed systems it&rsquo;s worth doing enough background research to have a hope of spotting these issues.</p>

<p>This doesn&rsquo;t necessarily mean you have to be an expert on everything you consider touching. It does mean you&rsquo;ll have to do enough research to discover the people who <em>are</em> experts so that you can get well thought out feedback about the ideas you&rsquo;re considering using.</p>

<p>This extends even to things like choosing which blogs to follow. You won&rsquo;t be able to follow all of them, so if you can find a &ldquo;core&rdquo; of people whose opinion you value they can act as a pre-filter for you on interesting new ideas, with out you trying to track all of their sources independently.</p>

<h2><a name="companies"></a> As a Company</h2>

<p>This is all great &ndash; but all of these things give knowledge to an individual. How do you share the learning around?</p>

<p>Some of these things carry across directly, of course: you should have a conference budget. You should have a training budget, too &ndash; and you should almost certainly be providing in house training for your own in house tools and procedures.</p>

<p>But that only really helps for the things that people know they don&rsquo;t know; when they&rsquo;ve realised they&rsquo;ve hit a problem and they need some knowledge. How do you share the more nebulous things? No one is going to wake up one morning and realise that the problem they&rsquo;re currently tackling would be better solved by a functional programming technique if they don&rsquo;t know what functional programming <em>is</em>.</p>

<p><a href="https://mikehadlow.com">Mike Hadlow</a> came up with a solution for this years ago that he implemented at <a href="http://15below.com">15below</a> which we&rsquo;re still using.</p>

<p>His proposal was deceptive simple: one hour a week is spent on group &ldquo;Developer Education.&rdquo; Someone prepares a topic and promises to provide notes (or a recording) afterwards &ndash; everyone else just turns up. We call them DevEds, and they run every Friday morning at 9:00am.</p>

<p>It doesn&rsquo;t sound much, does it? But actually, it&rsquo;s had a huge impact in the company. And we keep on getting asked how we do it, and how it works, so I&rsquo;m going to try and explain!</p>

<h3>What subjects?</h3>

<p>We&rsquo;re not completely random in subject choices &ndash; but we are deliberately broad. Basically, the subjects fall into three main categories:</p>

<p>1) Communication of internal changes</p>

<p>A team releases a new service for our core product. A new internal code review process is put in place. For these kind of events, we use the DevEd as a vehicle for communication to developers within the company, making sure everyone is aware of the change and allowing people to ask questions. Sometimes we&rsquo;ll put a requirement on a DevEd of this type that at least one developer from each team needs to be there (DevEds are not compulsory &ndash; just highly recommended).</p>

<p>2) Things we could be using already</p>

<p>We use Microsoft&rsquo;s .net languages for development, so (for example) we run sessions on the new features in the latest version of C# each time we upgrade. These are things that developers can go back out into the office and use today; also in this category are things like open source libraries we&rsquo;re already using.</p>

<p>3) Potential new tools and general programming knowledge</p>

<p><a href="http://en.wikipedia.org/wiki/SOLID_%28object-oriented_design%29">SOLID</a> programming. Why you shouldn&rsquo;t do thread management by hand. <a href="http://blog.mavnn.co.uk/property-checking-start-challenge/">Property based testing</a> (that link is a write up of an actual DevEd session, if you&rsquo;re interested). This is where we try and introduce people to ideas they should be aware of, introduce new tools and languages that we are considering using but aren&rsquo;t yet or try and teach people how to <em>think</em> about development rather than how to <em>do</em> development. We also
tend to throw some fairly odd ball things into this category to keep people thinking, and to avoid people only knowing about things within &ldquo;our expertise.&rdquo; For example, although we&rsquo;re a Windows .net programming house we&rsquo;ve run sessions on using Emacs and Vim. Why? Because a lot of programmers use these tools, and get a great deal of value from them. Which means they probably have things to teach us if we care to learn. And yes &ndash; this blog post was written in Vim!</p>

<p>The idea in this category is not normally that a person will come out of the session being able to use something straight away &ndash; but they should now be aware it exists, and know what to look up if they do need to use it.</p>

<h3>But I don&rsquo;t learn listening to lectures!</h3>

<p>Different people learn in different ways. So we try and teach in different ways: most of our sessions are live coding demos, but some are straight up presentations; others are white board round table discussions (thrown Lego pieces optional); and we&rsquo;re trying to build in more and more practical sessions as we go forward, with groups of two or three people (preferably from different teams) working together to explore the &lsquo;thing&rsquo; we&rsquo;re looking at.</p>

<h3>The benefits</h3>

<p>What does all this buy us?</p>

<p>Well: a few things. The benefits of having a built in internal comms session is a big benefit in it&rsquo;s own right. Breaking changes to our auto-deploy system can be announced up front in a format that has more impact than any email would ever had. We don&rsquo;t always have the luxury (or remember to use it!) but when we have, it&rsquo;s worked well.</p>

<p>For keeping people up to date on the technologies and techniques within the company, I count it as invaluable. For an old-ish code base, you&rsquo;ll find C# 5.0 async/await, F# code, LINQ usage in our core product&hellip; all the types of shiny new things that save bucket loads of time when you&rsquo;re coding, but a lot of &ldquo;enterprise&rdquo; development houses will tell you not to use in case &lsquo;not everyone can understand and maintain the code&rsquo;. For us, this is much less of a problem: if a DevEd has already happened, you&rsquo;ve
either been exposed to the concepts or you can look up the presenter and, hey presto, you have an expert to ask. If there hasn&rsquo;t been one, you just ask for it &ndash; and you&rsquo;re guaranteed to have a suitable expert to deliver the session (the author of the code in question).</p>

<p>The blue sky sessions sound the least practical, but I suspect they actually have the largest impact. As software houses, we tend to specialise: a particular programming language, a particular operating system, preferred libraries, preferred database server, the list goes on. On the one hand, this is good: you <em>must</em> be expert in the tools of your trade. On the other hand, this can be crippling: if you stop evaluating the new things that come along, you&rsquo;ll go out of date. This
causes two big problems: firstly, you&rsquo;re no longer using the best tools for the job. Secondly, the staff you want most will leave.</p>

<p>They will. The people who you really want building your code will be doing all of the things from the first half of this post <em>in their own time anyway</em>. That means they&rsquo;ll know that the grass is greener. That there&rsquo;s a better way to do things. That there&rsquo;s already a respected open source project that does the thing you&rsquo;ve asked them to create on a shoe string time and testing budget. They&rsquo;ll know, they&rsquo;ll skill up, and they&rsquo;ll leave. This doesn&rsquo;t mean you should always be using the
latest &ldquo;new and shiny&rdquo; just because it is &ldquo;new and shiny&rdquo; &ndash; but it does mean that if one of your developers comes to you and says &lsquo;there is a better way!&rsquo;, you really should listen and find out if there is. And then tell the rest of the developers, so they stay excited about staying too.</p>

<h3>Preparation time</h3>

<p>Ok, so if you&rsquo;re a manager this has probably all sounded great up until this point. I mean, an hour on Friday morning when the Developers are still normally rubbing the sleep out of their eyes anyway? Good deal!</p>

<p>Let&rsquo;s hit pause for a moment.</p>

<p>These sessions are something we take reasonably seriously; some of them get more prep than others, but I can safely say that a lot of them take a full working day between preparation and post session write up (or recording upload etc). That&rsquo;s a lot of time.</p>

<p>I&rsquo;ve had a lot of questions about how we make this work, and frankly the answer is mostly me. Not me, the individual person. But me, my role: having a person who has as a serious job priority internal technical training and communication. It&rsquo;s not my only responsibility, but it&rsquo;s up there on my list in a way that it isn&rsquo;t for our other developers. This means that I have a back up session planned most of the time for if an other developer has to drop doing a session because a
project is running late. I make sure (most of the time!) that there are a few future sessions planned in. I provide support for people who know a subject but aren&rsquo;t comfortable presenting to do their first sessions.</p>

<p>I do end up also delivering the majority of the sessions; I&rsquo;ve a fairly broad range of background knowledge and as I&rsquo;m not generally running on a project critical path I&rsquo;m the &ldquo;goto&rdquo; guy if no one else is available. But that&rsquo;s not the most important thing I provide: it&rsquo;s the ongoing push to make sure these sessions don&rsquo;t just happen this week, but that they keep on happening in the future. Which means I&rsquo;m not doing other things for the company.</p>

<p>So I suppose the final message here is: if you&rsquo;re in a company where this isn&rsquo;t happening, and you have time/resource allocation responsibilities&hellip; read the benefits section again and ask yourself how your company is meeting those needs. If you&rsquo;re a developer in a company where this kind of thing or an equivalent doesn&rsquo;t happen, you pretty much only have two choices: make it happen yourself with &ldquo;brown bag&rdquo; sessions and lunch breaks &ndash; being aware that you&rsquo;re basically training yourself, and
others, to be ready to leave. Or try and convince the decision makers that keeping the business up to date is worth it. I hope this post helps.</p>

<p>If you are already doing something: awesome! Tell us about it in the comments. We like what we&rsquo;ve got, but we&rsquo;re not above stealing better ideas.</p>

<h2>Appendix</h2>

<p>Whenever I get asked about this whole process over a conference beer, the follow up is always: what subjects have you covered?</p>

<p>In terms of what the output looks like, <a href="http://blog.mavnn.co.uk/blog/categories/15below/">this blog&rsquo;s achieves will give you a selection of DevEd write ups</a>.</p>

<p>More generally, here&rsquo;s a selection of session titles from the last few years (with purely internal communication subjects removed, obviously):</p>

<ul>
<li><p>GitFlow Intro</p></li>
<li><p>Database Normalisation</p></li>
<li><p>SQL Server Storage and IO</p></li>
<li><p>Error handling with Choice</p></li>
<li><p>Introduction to NodaTime And Humanizer</p></li>
<li><p>Text Editing with vim &amp; emacs</p></li>
<li><p>Functionally SOLID</p></li>
<li><p>Influx</p></li>
<li><p>WebSQL</p></li>
<li><p>Intro to Threading</p></li>
<li><p>FsUnit and TickSpec</p></li>
<li><p>Mobile apps using PhoneGap</p></li>
<li><p>Adaptive Programming to Reduce Config</p></li>
<li><p>What is a Reverse Proxy</p></li>
<li><p>Meet EmoteBot &ndash; C# Async and Await</p></li>
<li><p>SemVers and Nuget</p></li>
<li><p>AOP &ndash; Aspect Oriented Programming</p></li>
<li><p>How To Write Scalable Services</p></li>
<li><p>A refactoring example</p></li>
<li><p>DDD 2 &ndash; Applying Strategic Design</p></li>
<li><p>DDD Strategic Design</p></li>
<li><p>Introduction to F#</p></li>
<li><p>What is REST</p></li>
<li><p>The basics of TCP/IP</p></li>
<li><p>RabbitMQ</p></li>
<li><p>LINQ To Objects from scratch</p></li>
<li><p>Estimation game</p></li>
<li><p>Real world SRP</p></li>
<li><p>Approval Tests</p></li>
<li><p>Web API</p></li>
<li><p>Octopus and Teamcity</p></li>
<li><p>Solid</p></li>
<li><p>Safe Refactoring</p></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Functionally SOLID 2]]></title>
    <link href="http://blog.mavnn.co.uk/functionally-solid-2/"/>
    <updated>2014-05-09T13:43:02+01:00</updated>
    <id>http://blog.mavnn.co.uk/functionally-solid-2</id>
    <content type="html"><![CDATA[<p><em>This post follows on directly from <a href="/going-functionally-solid">Going Functionally SOLID</a></em></p>

<p>In our first session looking at <a href="http://en.wikipedia.org/wiki/Solid_%28object-oriented_design%29">SOLID</a> and functional programming, we tried to apply some SOLID principles to an example piece of code.</p>

<p>We ended up with a set of interfaces like those below, and robot classes could then implement the interfaces to define their capabilities and state. I mentioned the example code was for a giant robot game, yes?</p>

<!-- more -->


<p>```fsharp
type IDestructable =</p>

<pre><code>abstract Armour : int
abstract Dodge : int
abstract Hits : int
abstract Destroyed : bool
abstract TakeDamage : int -&gt; IDestructable
</code></pre>

<p>type IWalk =</p>

<pre><code>abstract Walk : Direction * int -&gt; Location
</code></pre>

<p>type IJump =</p>

<pre><code>abstract Jump : Direction * int -&gt; Location
</code></pre>

<p>type IFly =</p>

<pre><code>abstract Fly : Direction * int -&gt; Location
</code></pre>

<p>type IHazWeapon =</p>

<pre><code>abstract Fire : IDestructable * int -&gt; IDestructable
</code></pre>

<p>type IHazWeapons =</p>

<pre><code>abstract WMDs : List&lt;IHazWeapon&gt;
</code></pre>

<p>type IHazCannon =</p>

<pre><code>inherit IHazWeapon
</code></pre>

<p>type IHazMissiles =</p>

<pre><code>inherit IHazWeapon
</code></pre>

<p>type ITransforming =</p>

<pre><code>abstract Mode : string
abstract ``Transform!`` : string -&gt; ITransforming
</code></pre>

<p>```</p>

<p>For anyone who&rsquo;s worked with SOLID OO code before, this should be looking fairly familiar, and it should be obvious how you could build a class that accepted implementations of these interfaces in it&rsquo;s constructor and then carried the state of the robot (location, hits remaining, etc) around as mutable fields.</p>

<p>But&hellip; this is a turn based game, and we&rsquo;ve decided that we want to use a <a href="http://en.wikipedia.org/wiki/Minimax">minimax</a> approach to choosing moves for the computer player. Minimax is effectively a tree search, which means that implementing it looks like it would be a prime moment for a bit of concurrency. Each branch of the tree can be calculated independently, after all.</p>

<p>Unfortunately&hellip; our SOLID OO approach is not looking very thread safe. Functional programming revolves around the idea that code is <a href="http://en.wikipedia.org/wiki/Referential_transparency_%28computer_science%29">referentially transparent</a> and that data types are <a href="http://en.wikipedia.org/wiki/Immutable_object">immutable</a>. These two properties immediately lead to thread safe code.</p>

<p>So the rest of the session was spent trying out how different parts of the API code be modelled in a more functional way &ndash; splitting out state into separate immutable value objects, using functions in the place of single method interfaces and playing with discriminated unions (not strictly functional programming related, but they do seem to crop up regularly in functional style languages).</p>

<p>The end results, raw from the discussion, are below. A bit of a mix of the &ldquo;interface&rdquo; and experiments in how you would use it. I think it came out quite nicely, showing how all of the SOLID principles (apart from maybe &ldquo;L&rdquo;!) fall out naturally in nicely designed functional code just as they do in good OO code. In fact some of them, such as &ldquo;Interface Segregation&rdquo; and &ldquo;Single Responsibility&rdquo; are things you almost have to work to avoid &ndash; they both fall out naturally from passing around
pure functions to implement behaviour.</p>

<p>```fsharp
type Destructable =</p>

<pre><code>{
    Armour : int
    Dodge : int
    Hits : int
    Destroyed : bool
}
</code></pre>

<p>// Interface segregation and
// Single responsibility at work
type WeaponFunc =</p>

<pre><code>Destructable -&gt; int -&gt; Destructable
</code></pre>

<p>type Weapon =</p>

<pre><code>| Missile of WeaponFunc
| Cannon of WeaponFunc
</code></pre>

<p>type MoveFunc =</p>

<pre><code>Location -&gt; (Direction * int) -&gt; Location
</code></pre>

<p>type Move =</p>

<pre><code>| Run of MoveFunc
| Jump of MoveFunc
| Fly of MoveFunc
</code></pre>

<p>type Robot =</p>

<pre><code>{
    Id : string
    MovementTypes : Move list
    Weapons : Weapon list
    Location : Location
    DamageStatus : Destructable
}
</code></pre>

<p>// Dependency inversion!
let GiantRobo =</p>

<pre><code>{
    Id = "GiantRobo"
    MovementTypes = [ Run &lt;| fun l m -&gt; l ]
    Weapons = [ Cannon &lt;| fun d i -&gt; d ]
    Location = { Position = (0, 0); Altitude = 0 }
    DamageStatus = { Armour = 10; Dodge = 5; Hits = 100; Destroyed = false }
}
</code></pre>

<p>// Open/closed principle via higher order
// functions
let makeFly runFunc l m =</p>

<pre><code>let newPosition = runFunc l m
{ newPosition with Altitude = 100 }
</code></pre>

<p>let TinyRobo =</p>

<pre><code>{
    Id = "TinyRobo"
    MovementTypes = [ Run &lt;| fun l m -&gt; { l with Position = (10, 10) } ]
    Weapons = [ Cannon &lt;| fun d i -&gt; d ]
    Location = { Position = (0, 0); Altitude = 0 }
    DamageStatus = { Armour = 10; Dodge = 5; Hits = 100; Destroyed = false }
}
</code></pre>

<p>// Separating behaviour and state
module BlowThingsUp =</p>

<pre><code>let TakeDamage destructable damage =
    let newHits = destructable.Hits - damage
    {   destructable with
            Hits = newHits
            Destroyed = newHits &lt;= 0
    }
</code></pre>

<p>// Different possibilities for
// extending that would normally be handled
// by inheritance in OO
module TransformVF1 =</p>

<pre><code>let transform robot =
    {
        robot with
            MovementTypes = [Fly &lt;| fun l m -&gt; { l with Altitude = 100 }]
    }
</code></pre>

<p>type TransformFunc =</p>

<pre><code>Robot -&gt; Robot
</code></pre>

<p>type RobotModel =</p>

<pre><code>| NormalRobot of Robot
| TransformingRobot of Robot * TransformFunc
</code></pre>

<p>type MaybeTransformFunc =</p>

<pre><code>MaybeTransformingRobot -&gt; MaybeTransformingRobot
</code></pre>

<p>and MaybeTransformingRobot =</p>

<pre><code>{
    Id : string
    MovementTypes : Move list
    Weapons : Weapon list
    Location : Location
    DamageStatus : Destructable
    Transform : MaybeTransformFunc option
}
</code></pre>

<p>let Transform mtr =</p>

<pre><code>match mtr.Transform with
| None -&gt;
    mtr
| Some trans -&gt;
    trans mtr
</code></pre>

<p>```</p>

<p>Enjoy, and comments welcome &ndash; this was live coded in a group environment, so I&rsquo;m sure plenty of opportunities for nicer code were missed!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Going Functionally SOLID]]></title>
    <link href="http://blog.mavnn.co.uk/going-functionally-solid/"/>
    <updated>2014-04-11T11:45:47+01:00</updated>
    <id>http://blog.mavnn.co.uk/going-functionally-solid</id>
    <content type="html"><![CDATA[<p><em>The one giant robot every programmer should know and love! Meet Big O!</em></p>

<p><img src="/images/Big_o.jpg" alt="Big O" /></p>

<p><em>For all your algorithmic complexity needs. And any giant mecha in need of a good pounding.</em></p>

<p>And now, back to your regularly scheduled blog post&hellip;</p>

<p>Inspired both by <a href="http://blog.ploeh.dk/2014/03/10/solid-the-next-step-is-functional/">Mark Seemann&rsquo;s excellent blog post</a> and by my ongoing campaign to introduce functional programming techniques to <a href="http://www.15below.com/">15below</a> developers who aren&rsquo;t familiar with them yet, I decided it was time to run a mini-series on applying good principles like <a href="http://en.wikipedia.org/wiki/Solid_%28object-oriented_design%29">SOLID</a> in a functional world.</p>

<p>We run weekly one hour &ldquo;Developer Education&rdquo; sessions. For this series I started with a badly written piece of code (it came naturally, given I had limited prep time&hellip;) in a style of someone who has kind of heard about SOLID and functional programming:</p>

<ul>
<li><strong>SOLID</strong>: &ldquo;So, eh, I need some interfaces and things. Concrete bad, interface good. In wonder what the whole DI thing is?&rdquo;</li>
<li><strong>Functional</strong>: &ldquo;And, erm. Chainable functions? Fluent APIs, maybe? That&rsquo;s kind of functional, right?&rdquo;</li>
</ul>


<!-- More -->


<p>And then we had a open house suggesting modifications to the code where I made the changes live as we went along. In this first session, we only got as far as making the code a bit more solid &ndash; tune back in next month for the make it functional session..</p>

<p>Deciding that we needed a more interesting example domain than sending emails for once, I decided to go the whole hog. Below you&rsquo;ll find the before and after versions of &ldquo;HeavyGearSOLID&rdquo;&rsquo;s unit representation code.</p>

<p>Because everything is better with giant robots.</p>

<p>The session was a fun change of pace from other things we&rsquo;ve done, and sparked off a nice bit of discussion (although not as much as I hoped&hellip; heckle more, 15below people!). I&rsquo;m quite looking forward to the next part of the series.</p>

<h2>Before</h2>

<p><code>` fsharp
namespace</code>メタルギアソリッド``</p>

<p>open System
open Utils</p>

<p>type IMecha =</p>

<pre><code>abstract Walk : Direction * int -&gt; IMecha
abstract Jump : Direction * int -&gt; IMecha
abstract Fly : Direction * int -&gt; IMecha
abstract Position : int * int
abstract Hits : int
abstract Destroyed : bool
abstract Dodge : int
abstract Armour : int
abstract TakeDamage : int -&gt; IMecha
abstract FireCannon : IMecha * int -&gt; IMecha
abstract FireMissiles : IMecha * int -&gt; IMecha
</code></pre>

<p>type GiantRobo (position) =</p>

<pre><code>let _position = ref position
let _hits = ref 100
let _destroyed = ref false
let _dodge = ref 5
let _armour = ref 20
let rand = Random()
interface IMecha with
    member x.Walk (dir, distance) =
        let iMecha = x :&gt; IMecha
        if distance &gt; 4 then
            failwith "GiantRobo is slow!"
        else
            _position := Move (!_position) dir distance
            iMecha
    member x.Jump (_, _) =
        raise &lt;| NotImplementedException("GiantRobo can't jump")
    member x.Fly (_, _) =
        raise &lt;| NotImplementedException("GiantRobo can't fly")
    member x.Position =
        !_position
    member x.Hits =
        !_hits                        
    member x.Destroyed =
        !_destroyed
    member x.Dodge =
        !_dodge
    member x.Armour =
        !_armour
    member x.TakeDamage damage =
        _hits := !_hits - damage
        _destroyed := !_hits &lt;= 0
        x :&gt; IMecha
    member x.FireCannon (target, roll) =
        if roll &gt; target.Dodge then
            target.TakeDamage (max 0 (60 - target.Armour))
        else
            target
    member x.FireMissiles (target, roll) =
        raise &lt;| NotImplementedException("Giant Robo has no missiles")
</code></pre>

<p>type ITransformingMecha =</p>

<pre><code>inherit IMecha
abstract Mode : string
abstract ``Transform!`` : string -&gt; ITransformingMecha
</code></pre>

<p>type VF1 (position) =</p>

<pre><code>let _position = ref position
let _hits = ref 50
let _destroyed = ref false
let _dodge = ref 10
let _armour = ref 10
let _mode = ref "Battroid"
interface ITransformingMecha with
    member x.Walk (dir, distance) =
        let iMecha = x :&gt; IMecha
        if !_mode = "Fighter" then failwith "No legs in Fighter mode!"
        if distance &gt; 6 then
            failwith "VF-1 isn't that fast!"
        else
            _position := Move (!_position) dir distance
            iMecha
    member x.Jump (dir, distance) =
        let iMecha = x :&gt; IMecha
        if !_mode = "Fighter" then failwith "Jumping in Fighter mode makes no sense!"
        let maxDistance =
            match !_mode with
            | "GERWALK" -&gt; 8
            | "Battroid" -&gt; 6
            | _ -&gt; failwith "No good"
        if distance &gt; maxDistance then
            failwith "VF-1 isn't that fast!"
        else
            _position := Move (!_position) dir distance
            iMecha
    member x.Fly (dir, distance) =
        let iMecha = x :&gt; IMecha
        if !_mode = "Battroid" then failwith "Battroid mode can't fly"
        let maxDistance =
            match !_mode with
            | "Fighter" -&gt; 20
            | "GERWALK" -&gt; 15
            | _ -&gt; failwith "No good"
        if distance &gt; maxDistance then
            failwith "VF-1 isn't that fast!"
        else
            _position := Move (!_position) dir distance
            iMecha
    member x.Position =
        !_position
    member x.Hits =
        !_hits                        
    member x.Destroyed =
        !_destroyed
    member x.Dodge =
        !_dodge
    member x.Armour =
        !_armour
    member x.TakeDamage damage =
        _hits := !_hits - damage
        _destroyed := !_hits &lt;= 0
        x :&gt; IMecha
    member x.FireCannon (target, roll) =
        if roll &gt; target.Dodge then
            target.TakeDamage (max 0 (20 - target.Armour))
        else
            target
    member x.FireMissiles (target, roll) =
        if roll &gt; (target.Dodge / 2) then
            target.TakeDamage (max 0 (60 - target.Armour))
        else
            target
    member x.Mode =
        !_mode
    member x.``Transform!`` mode =
        match mode with
        | "Fighter" -&gt;
            _mode := "Fighter"
        | "GERWALK" -&gt;
            _mode := "GERWALK"
        | "Battroid" -&gt;
            _mode := "Battroid"
        | _ -&gt;
            failwith "Not a valid VF-1 mode"
        x :&gt; ITransformingMecha
</code></pre>

<p>```</p>

<h2>After</h2>

<p><code>` fsharp
namespace</code>メタルギアソリッド``</p>

<p>open System
open Utils</p>

<p>type Location =</p>

<pre><code>{
    Position : int * int
    Altitude : int
}
</code></pre>

<p>type IDestructable =</p>

<pre><code>abstract Armour : int
abstract Dodge : int
abstract Hits : int
abstract Destroyed : bool
abstract TakeDamage : int -&gt; IDestructable
</code></pre>

<p>type IWalk =</p>

<pre><code>abstract Walk : Direction * int -&gt; Location
</code></pre>

<p>type IJump =</p>

<pre><code>abstract Jump : Direction * int -&gt; Location
</code></pre>

<p>type IFly =</p>

<pre><code>abstract Fly : Direction * int -&gt; Location
</code></pre>

<p>type IHazWeapon =</p>

<pre><code>abstract Fire : IDestructable * int -&gt; IDestructable
</code></pre>

<p>type IHazWeapons =</p>

<pre><code>abstract WMDs : List&lt;IHazWeapon&gt;
</code></pre>

<p>type IHazCannon =</p>

<pre><code>inherit IHazWeapon
</code></pre>

<p>type IHazMissiles =</p>

<pre><code>inherit IHazWeapon
</code></pre>

<p>type NormalDestructable (hits, dodge, armour) =</p>

<pre><code>let _hits = ref 100
let _destroyed = ref false
let _dodge = ref 5
let _armour = ref 20
interface IDestructable with
    member x.Hits =
        !_hits                        
    member x.Destroyed =
        !_destroyed
    member x.Dodge =
        !_dodge
    member x.Armour =
        !_armour
    member x.TakeDamage damage =
        _hits := !_hits - damage
        _destroyed := !_hits &lt;= 0
        x :&gt; IDestructable
</code></pre>

<p>type GiantRobo (position, destructable : #IDestructable) =</p>

<pre><code>let _position = ref position
member x.Position =
    !_position
interface IWalk with
    member x.Walk (dir, distance) =
        if distance &gt; 4 then
            failwith "GiantRobo is slow!"
        else
            { Position = Move (!_position) dir distance; Altitude = 0 }
interface IDestructable with
    member x.Hits = destructable.Hits
    member x.Destroyed = destructable.Destroyed
    member x.Dodge = destructable.Dodge
    member x.Armour = destructable.Armour
    member x.TakeDamage damage = destructable.TakeDamage damage
interface IHazWeapons with
    member x.WMDs =
        [{ new IHazCannon with 
            member x.Fire (target, roll) =
                if roll &gt; target.Dodge then
                    target.TakeDamage (max 0 (60 - target.Armour))
                else
                    target }]
</code></pre>

<p>type ITransforming =</p>

<pre><code>abstract Mode : string
abstract ``Transform!`` : string -&gt; ITransforming
</code></pre>

<p>type VF1 (position) =</p>

<pre><code>let _position = ref position
let _mode = ref "Battroid"
member x.Position =
    !_position
interface IWalk with
    member x.Walk (dir, distance) =
        if !_mode = "Fighter" then failwith "No legs in Fighter mode!"
        if distance &gt; 6 then
            failwith "VF-1 isn't that fast!"
        else
            { Position = Move (!_position) dir distance; Altitude = 0 }
interface IJump with
    member x.Jump (dir, distance) =
        if !_mode = "Fighter" then failwith "Jumping in Fighter mode makes no sense!"
        let maxDistance =
            match !_mode with
            | "GERWALK" -&gt; 8
            | "Battroid" -&gt; 6
            | _ -&gt; failwith "No good"
        if distance &gt; maxDistance then
            failwith "VF-1 isn't that fast!"
        else
            { Position = Move (!_position) dir distance; Altitude = 0 }
interface IFly with
    member x.Fly (dir, distance) =
        if !_mode = "Battroid" then failwith "Battroid mode can't fly"
        let maxDistance =
            match !_mode with
            | "Fighter" -&gt; 20
            | "GERWALK" -&gt; 15
            | _ -&gt; failwith "No good"
        if distance &gt; maxDistance then
            failwith "VF-1 isn't that fast!"
        else
            { Position = Move (!_position) dir distance; Altitude = 0 }
interface IHazWeapons with
    member x.WMDs =
        [
            { new IHazCannon with
                member x.Fire (target, roll) =
                    if roll &gt; target.Dodge then
                        target.TakeDamage (max 0 (20 - target.Armour))
                    else
                        target };
             { new IHazMissiles with
                member x.Fire (target, roll) =
                    if roll &gt; (target.Dodge / 2) then
                        target.TakeDamage (max 0 (60 - target.Armour))
                    else
                        target }
        ]
interface ITransforming with
    member x.Mode =
        !_mode
    member x.``Transform!`` mode =
        match mode with
        | "Fighter" -&gt;
            _mode := "Fighter"
        | "GERWALK" -&gt;
            _mode := "GERWALK"
        | "Battroid" -&gt;
            _mode := "Battroid"
        | _ -&gt;
            failwith "Not a valid VF-1 mode"
        x :&gt; ITransforming
</code></pre>

<p>```</p>

<p><em>This series continues in the imaginatively named &ldquo;<a href="/functionally-solid-2/">Functionally SOLID 2</a>&rdquo;</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Coding Hygiene: Moving from project references to NuGet dependencies]]></title>
    <link href="http://blog.mavnn.co.uk/coding-hygiene-moving-from-project-references-to-nuget-dependencies/"/>
    <updated>2013-03-08T17:08:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/coding-hygiene-moving-from-project-references-to-nuget-dependencies</id>
    <content type="html"><![CDATA[<p>So, first post with the new blogging engine. Let&rsquo;s see how it goes.</p>

<p>Our code base at <a href="http://15below.com">15below</a> started it&rsquo;s life a fair
while ago, well before any form of .NET package management became
practical. Because of that, we ended up building a lot of code in
&lsquo;lockstep&rsquo; with project references in code as there was no sensible way
of taking versioned binary dependencies.</p>

<p>That&rsquo;s fine and all, but it encourages bad code hygiene: rather than
having sharply defined contracts between components, if you&rsquo;ve got them
all open in the same solution it becomes far too tempting to just nudge
changes around as it&rsquo;s convenient at the time. Changes can infect other
pieces of code, and the power of automatic refactoring across the entire
solution becomes intoxicating.</p>

<p>The result? It becomes very hard to do incremental builds (or
deployments, for that matter). This in turn makes for a long feed back
cycle between making a change, and being able to see it rolled out to a
testing environment.</p>

<p>So as part of the ongoing refactoring that any long lived code base needs to
keep it maintainable and under control, we&rsquo;ve embarked on the process of
splitting our code down into more logically separated repositories that
reference each other via NuGet. This will require us to start being much
more disciplined in our <a href="http://semver.org">semantic versioning</a> than we
have been in the past, but will also allow us to build and deploy
incrementally and massively reduce our feed back times.</p>

<p>As part of splitting out the first logical division (I&rsquo;d like to say
<a href="http://en.wikipedia.org/wiki/Domain-driven_design">domain</a> but we&rsquo;re
not there yet!), I created the new repository and got the included
assemblies up and building on TeamCity. It was only then (stupidly) that
I realised that we had several hundred project references to these
assemblies in our code. There was no way I was going to update them all
by hand, so after a few hours development we now have a script for
idempotently updating a project reference in a [cs|vb|fs]proj file to a
NuGet reference. It does require you to do one update manually first;
especially with assemblies that are strongly signed, I chickened out of
trying to generate the reference nodes that needed to be added
automatically. The script also makes sure that you end up with a
packages.config file with the project that includes the new dependency.</p>

<p>It should be noted that this script has only seen minimal testing, was
coded up for one time use and does not come with a warranty of any kind!
Use at your own risk, and once you understand what it&rsquo;s doing. But for
all that, I hope you find it useful.</p>

<p><div><script src='https://gist.github.com/mavnn/5983379.js'></script>
<noscript><pre><code></code></pre></noscript></div>
</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Throttling the level of concurrency in F#]]></title>
    <link href="http://blog.mavnn.co.uk/throttling-the-level-of-concurrency-in-f/index.html"/>
    <updated>2013-02-15T00:00:00+00:00</updated>
    <id>http://blog.mavnn.co.uk/throttling-the-level-of-concurrency-in-f/throttling-the-level-of-concurrency-in-f</id>
    <content type="html"><![CDATA[<div>Async.Parallel |&gt; Async.RunSynchronously is great for running a load of stuff in parallel in F#, as long as you don&#39;t mind them all running at the same time.</div>


<p><p /><div>Often, though, you want to map across a sequence and run functions on the elements in parallel, but with a limit to how many are being processed concurrently. Whether you&#39;re doing something CPU heavy and there&#39;s no point running more than the number of processors on the box, or whether you know that you&#39;ll swamp a remote server if you just dump all of your connections on it at once, this issue comes up surprisingly often.</div> <p /><div>As a first stab, you might be tempted to do something like this (if you think like I do):</div><p /><div><script src="https://gist.github.com/4961072.js"></script><br /> </div><p /><div>In a word: don&#39;t. The contention in the Semaphore make this enormously inefficient with even a few hundred tasks.</div><p /><div>In the end, the simplest  implementation I could come up with that didn&#39;t involve dragging in external dependencies was the following:</div> <p /><div><script src="https://gist.github.com/4961056.js"></script><br /></div><p /><div>If anyone has a simpler implementation, leave a comment and let me know!</div></p>
]]></content>
  </entry>
  
</feed>
