<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: teaching | Mavnn's blog]]></title>
  <link href="https://blog.mavnn.co.uk/blog/categories/teaching/atom.xml" rel="self"/>
  <link href="https://blog.mavnn.co.uk/"/>
  <updated>2017-08-08T15:06:32+01:00</updated>
  <id>https://blog.mavnn.co.uk/</id>
  <author>
    <name><![CDATA[mavnn]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Introducing F# to Experienced Developers]]></title>
    <link href="https://blog.mavnn.co.uk/introducing-f-number-to-experienced-developers/"/>
    <updated>2013-10-14T12:30:00+01:00</updated>
    <id>https://blog.mavnn.co.uk/introducing-f-number-to-experienced-developers</id>
    <content type="html"><![CDATA[<p>So, as a follow up to <a href="https//blog.mavnn.co.uk/teaching-f-number-to-c-number-devs/">this post</a> I&#39;m in the final stages of preparing a presentation for this Friday introducing an audience of (mostly) fairly experienced developers to F# and F# syntax. The main reason for this is to get a number of people up to speed enough on reading F# that they can have a better experience at <a href="http://skillsmatter.com/event/scala/progressive-f-tutorials-2013">the Progressive F# Tutorials</a> at the end of the month. So the aim here isn&#39;t to get people fully autonomous and writing code <em>right now</em>, but to allow them to read the bulk of the example code in the tutorials and follow what&#39;s going on.</p>

<p>The general approach I&#39;ve gone for is to set up a Git repository that has a series of tagged snap shots I can check out as I work through the concepts I&#39;m planning to cover. This will enable me to actually demonstrate and run pieces of code, answer questions and make live modifications and then always jump back to a known starting point for the next section of the talk. Given the people involved have all done some .net development and I don&#39;t need to cover things like Visual Studio usage and projects, all of the code is contained in a single Program.fs file in a console app. I&#39;ve included the snapshot of the file from each tagged commit below, with a brief overview of what I&#39;m planning to introduce before skipping to the next snapshot.</p>

<p>With a full screen Visual Studio editing session, I should be able to make the code large enough to be visible and reasonably rapidly guide people to the areas where the code has changed.</p>

<p>A combination of the excellent <a href="http://papercut.codeplex.com/">PaperCut</a> project and a local &#39;http request to email&#39; service pretending to be an SMS sender, we should be able to see messages being generated by the code as we go along.</p>

<p>After the session, I&#39;m planning to mention <a href="https://github.com/ChrisMarinos/FSharpKoans">Chris Marinos&#39; koans</a> and <a href="http://www.tryfsharp.org/">Try F#</a> (especially given that Rachel Reese is <a href="http://skillsmatter.com/podcast/scala/try-f-from-zero-to-data-science">running a session</a> at the tutorials for those who are going).</p>

<p>Please note that these are up here for comment and suggestions at this point - I&#39;ll be pushing up the actual Git repository and a screencast (I hope) after the event. The code is designed to be a prop for the talk rather than an independent resource - for that I&#39;d always point people to the koans/Try F# first.</p>

<p>So, show me the codez:</p>

<!--more-->

<h2>Tag &#39;1&#39;</h2>

<p>Nothing too exciting here :). This is just a place holder while giving the introduction, although I will also point out the lack of required boiler plate compared to C#.</p>
<div class="highlight"><pre><code class="fsharp"><span class="c1">// Let&#39;s send an email!</span>
</code></pre></div>
<h2>Tag &#39;2&#39;</h2>

<p>Introduce the <code>open</code> keyword, <code>let</code> for value assignment, and give people a feel that they&#39;re not completely leaving their nice safe .net world behind.</p>
<div class="highlight"><pre><code class="fsharp"><span class="c1">// Let&#39;s send an email!</span>

<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="c1">// We only use the &#39;new&#39; keyword here because SmtpClient is disposable</span>
<span class="k">let</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>

<span class="c1">// And given it&#39;s disposable, we should really dispose of it...</span>
<span class="n">smtpClient</span><span class="o">.</span><span class="nc">Dispose</span><span class="bp">()</span>
</code></pre></div>
<h2>Tag &#39;3&#39;</h2>

<p>Talk about functions, show parameter application, introduce the pipe operator.</p>

<p>Some discussion about type inference will probably happen here.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="k">let</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>

<span class="c1">// This is a function</span>
<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">client</span> <span class="n">message</span> <span class="o">=</span>
    <span class="c1">// We&#39;d better do something here to actually</span>
    <span class="c1">// send a message...</span>
    <span class="n">printfn</span> <span class="s2">&quot;I haven&#39;t sent a mail message!&quot;</span>
    <span class="bp">()</span>

<span class="n">sendMessage</span> <span class="n">smtpClient</span> <span class="s2">&quot;My message&quot;</span>

<span class="n">smtpClient</span><span class="o">.</span><span class="nc">Dispose</span><span class="bp">()</span>

<span class="c1">// And we&#39;ll add this so we can see the output</span>
<span class="c1">// before it disappears</span>
<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
<span class="c1">// This line would be the same as writing:</span>
<span class="c1">//</span>
<span class="c1">// ignore (System.Console.Readline())</span>
<span class="c1">//</span>
<span class="c1">// but you have to admit that this is a bit </span>
<span class="c1">// more readable</span>
</code></pre></div>
<h2>Tag &#39;4&#39;</h2>

<p>Introduce the <code>use</code> keyword, show property assignment with <code>&lt;-</code>.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="k">let</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">client</span> <span class="n">message</span> <span class="o">=</span>
    <span class="c">(* Because we used &#39;use&#39; this will get</span>
<span class="c">    disposed at the end of the declaring</span>
<span class="c">    scope *)</span>
    <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span><span class="s2">&quot;me@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;you@example.com&quot;</span><span class="o">)</span>
    <span class="c">(* This is have you assign a parameter *)</span>
    <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
    <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">message</span>
    <span class="n">smtpClient</span><span class="o">.</span><span class="nc">Send</span> <span class="n">mailMessage</span>
    <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>

<span class="n">sendMessage</span> <span class="n">smtpClient</span> <span class="s2">&quot;My message&quot;</span>

<span class="n">smtpClient</span><span class="o">.</span><span class="nc">Dispose</span><span class="bp">()</span>
<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;5&#39;</h2>

<p>List syntax and introduce the <code>Seq</code> module. Example of currying.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="k">let</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">client</span> <span class="n">message</span> <span class="o">=</span>
    <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span><span class="s2">&quot;me@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;you@example.com&quot;</span><span class="o">)</span>
    <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
    <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">message</span>
    <span class="n">smtpClient</span><span class="o">.</span><span class="nc">Send</span> <span class="n">mailMessage</span>
    <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>

<span class="c">(* But really, what you want computers for</span>
<span class="c">is doing the same thing lots of times... *)</span>
<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="s2">&quot;My first message&quot;</span>
        <span class="s2">&quot;My second message&quot;</span>
        <span class="s2">&quot;My third and final message&quot;</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="n">sendMessage</span> <span class="n">smtpClient</span><span class="o">)</span>
<span class="c">(* Let&#39;s have some vindaloo with that map *)</span>

<span class="n">smtpClient</span><span class="o">.</span><span class="nc">Dispose</span><span class="bp">()</span>
<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;6&#39;</h2>

<p>An async workflow. Turns out that <code>SmtpClient</code> is not as clean for that as you would hope - it&#39;s async send methods don&#39;t appear to be thread safe (wait, what?) and even the relatively recent looking <code>SendMailAsync</code> method returns a <code>Task</code> rather than a <code>Task&lt;&#39;T&gt;</code>. Having said that, it shows that even in less than ideal circumstances, you can leverage the <code>async</code> stuff even when interfacing with older .net code from other languages.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>


<span class="c">(* But really, what you want computers for</span>
<span class="c">is doing the same thing lots of times... </span>
<span class="c">at the same time! *)</span>
<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">message</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="c1">// Move the client inside because...</span>
        <span class="c1">// have _you_ checked if it&#39;s thread safe?</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span><span class="s2">&quot;me@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;you@example.com&quot;</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">message</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="s2">&quot;My first message&quot;</span>
        <span class="s2">&quot;My second message&quot;</span>
        <span class="s2">&quot;My third and final message&quot;</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;7&#39;</h2>

<p>Tuples! Showing both construction and deconstruction syntax. Also discuss that this is how we pass multiple parameters to methods on classes.</p>

<p>In the live coding for this one, I&#39;ll make sure to demonstrate adding and removing brackets in different places.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">let</span> <span class="n">address</span><span class="o">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">messageDetails</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span><span class="s2">&quot;me@example.com&quot;</span><span class="o">,</span> <span class="n">address</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">body</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>


<span class="c">(* But we probably don&#39;t want to send all of these</span>
<span class="c">to the same person. *)</span>
<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="s2">&quot;first@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;My first message&quot;</span>
        <span class="s2">&quot;secord@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;My second message&quot;</span>
        <span class="s2">&quot;third@example.com&quot;</span><span class="o">,</span> <span class="s2">&quot;My third and final message&quot;</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;8&#39;</h2>

<p>Record syntax.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="c">(* How about if I want to pass lots of different bits</span>
<span class="c">of information in? *)</span>
<span class="k">type</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">body</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> 
            <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromAddress</span><span class="o">,</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toAddress</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">messageDetails</span><span class="o">.</span><span class="n">body</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My first message&quot;</span> <span class="o">}</span>
        <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;second@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;personal@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My second message&quot;</span> <span class="o">}</span>
        <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My third message&quot;</span> <span class="o">}</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;9&#39;</h2>

<p>Use discriminated unions for modeling business inputs. In this case, building a MessageDetails class that can contain the details of either an email or an SMS send request.</p>

<p>Also has a 2nd, maybe slightly more idiomatic implementation of an async workflow.</p>

<p>I&#39;m hoping to get at least this far in the session. The rest of it would be nice, but if we get here then I&#39;ll be happy I&#39;ve covered at least the basics.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">IO</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Net</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="c">(* But some people have given us mobile</span>
<span class="c">numbers rather than email addresses *)</span>
<span class="k">type</span> <span class="nc">EmailDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">body</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">SmsDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">message</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">MessageDetails</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="k">of</span> <span class="nc">EmailDetails</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="k">of</span> <span class="nc">SmsDetails</span>

<span class="k">let</span> <span class="n">sendEmail</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> 
            <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromAddress</span><span class="o">,</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toAddress</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">messageDetails</span><span class="o">.</span><span class="n">body</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">sendSms</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">let</span> <span class="n">http</span> <span class="o">=</span> <span class="nn">HttpWebRequest</span><span class="p">.</span><span class="nc">Create</span><span class="o">(</span><span class="s2">&quot;http://sms.local&quot;</span><span class="o">)</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebRequest</span>
        <span class="n">http</span><span class="o">.</span><span class="nc">Method</span> <span class="o">&lt;-</span> <span class="s2">&quot;POST&quot;</span>
        <span class="k">let</span> <span class="n">messagePayload</span> <span class="o">=</span>
            <span class="n">sprintf</span>
                <span class="s2">&quot;To: %s</span><span class="se">\n</span><span class="s2">From: %s</span><span class="se">\n</span><span class="s2">Message: %s&quot;</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">message</span>
        <span class="n">using</span> 
            <span class="o">(</span><span class="n">http</span><span class="o">.</span><span class="nc">GetRequestStream</span><span class="bp">()</span><span class="o">)</span>
            <span class="o">(</span><span class="k">fun</span> <span class="n">stream</span> <span class="o">-&gt;</span> 
                <span class="k">use</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamWriter</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>
                <span class="n">sw</span><span class="o">.</span><span class="nc">Write</span><span class="o">(</span><span class="n">messagePayload</span><span class="o">))</span>
        <span class="k">let</span><span class="o">!</span> <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="nc">GetResponseAsync</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitTask</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebResponse</span><span class="o">).</span><span class="nc">StatusCode</span> <span class="o">&lt;&gt;</span> <span class="nn">HttpStatusCode</span><span class="p">.</span><span class="nc">OK</span> <span class="k">then</span>
            <span class="n">failwith</span> <span class="s2">&quot;Http request failed!&quot;</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent an SMS!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">message</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">message</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendEmail</span> <span class="n">details</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendSms</span> <span class="n">details</span>

<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My first message&quot;</span> <span class="o">}</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;second@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;personal@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My second message&quot;</span> <span class="o">}</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My third message&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123124&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms x2&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms x3&quot;</span> <span class="o">}</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;10&#39;</h2>

<p>Validation with Active patterns.</p>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">IO</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Net</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>

<span class="k">type</span> <span class="nc">EmailDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">body</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">SmsDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">message</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">MessageDetails</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="k">of</span> <span class="nc">EmailDetails</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="k">of</span> <span class="nc">SmsDetails</span>

<span class="c">(* But what if some people have given us invalid data?</span>

<span class="c">Our SMS sender requires full numbers with national</span>
<span class="c">codes - let&#39;s add some validation! *)</span>
<span class="k">let</span> <span class="o">(|</span><span class="nc">ValidSmsRequest</span><span class="o">|</span><span class="nc">InvalidSmsRequest</span><span class="o">|)</span> <span class="n">details</span> <span class="o">=</span>
    <span class="c1">// Hmm. Bananas. My favourite.</span>
    <span class="k">let</span> <span class="n">regex</span> <span class="o">=</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Text</span><span class="p">.</span><span class="nn">RegularExpressions</span><span class="p">.</span><span class="nc">Regex</span><span class="o">(@</span><span class="s2">&quot;^</span><span class="err">\</span><span class="s2">+</span><span class="err">\</span><span class="s2">d</span><span class="err">\</span><span class="s2">d&quot;</span><span class="o">)</span>
    <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="nc">IsMatch</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="n">toNumber</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">regex</span><span class="o">.</span><span class="nc">IsMatch</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="n">fromNumber</span><span class="o">)</span> <span class="k">then</span>
        <span class="nc">ValidSmsRequest</span> <span class="n">details</span>
    <span class="k">else</span>
        <span class="nc">InvalidSmsRequest</span> <span class="s2">&quot;You must include the +xx country prefix on mobile numbers.&quot;</span>

<span class="k">let</span> <span class="n">sendEmail</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> 
            <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromAddress</span><span class="o">,</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toAddress</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">messageDetails</span><span class="o">.</span><span class="n">body</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>

<span class="c">(* We&#39;ve moved the SMS post logic into this method</span>
<span class="c">without change - no validation here.</span>

<span class="c">We&#39;ve marked it private so no one else can call it</span>
<span class="c">by mistake *)</span>
<span class="k">let</span> <span class="k">private</span> <span class="n">postSms</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">let</span> <span class="n">http</span> <span class="o">=</span> <span class="nn">HttpWebRequest</span><span class="p">.</span><span class="nc">Create</span><span class="o">(</span><span class="s2">&quot;http://sms.local&quot;</span><span class="o">)</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebRequest</span>
        <span class="n">http</span><span class="o">.</span><span class="nc">Method</span> <span class="o">&lt;-</span> <span class="s2">&quot;POST&quot;</span>
        <span class="k">let</span> <span class="n">messagePayload</span> <span class="o">=</span>
            <span class="n">sprintf</span>
                <span class="s2">&quot;To: %s</span><span class="se">\n</span><span class="s2">From: %s</span><span class="se">\n</span><span class="s2">Message: %s&quot;</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">message</span>
        <span class="n">using</span> 
            <span class="o">(</span><span class="n">http</span><span class="o">.</span><span class="nc">GetRequestStream</span><span class="bp">()</span><span class="o">)</span>
            <span class="o">(</span><span class="k">fun</span> <span class="n">stream</span> <span class="o">-&gt;</span> 
                <span class="k">use</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamWriter</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>
                <span class="n">sw</span><span class="o">.</span><span class="nc">Write</span><span class="o">(</span><span class="n">messagePayload</span><span class="o">))</span>
        <span class="k">let</span><span class="o">!</span> <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="nc">GetResponseAsync</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitTask</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebResponse</span><span class="o">).</span><span class="nc">StatusCode</span> <span class="o">&lt;&gt;</span> <span class="nn">HttpStatusCode</span><span class="p">.</span><span class="nc">OK</span> <span class="k">then</span>
            <span class="n">failwith</span> <span class="s2">&quot;Http request failed!&quot;</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent an SMS!&quot;</span>
    <span class="o">}</span>

<span class="c">(* And this is where we do our validation *)</span>
<span class="k">let</span> <span class="n">sendSms</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">messageDetails</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">ValidSmsRequest</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">postSms</span> <span class="n">details</span>
    <span class="o">|</span> <span class="nc">InvalidSmsRequest</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="n">async</span> <span class="o">{</span> <span class="n">printfn</span> <span class="s2">&quot;Sms sending error: %s&quot;</span> <span class="n">error</span> <span class="o">}</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">message</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">message</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendEmail</span> <span class="n">details</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendSms</span> <span class="n">details</span>

<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="o">[</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My first message&quot;</span> <span class="o">}</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;second@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;personal@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My second message&quot;</span> <span class="o">}</span>
        <span class="nc">Email</span> <span class="o">{</span> <span class="n">toAddress</span> <span class="o">=</span> <span class="s2">&quot;first@example.com&quot;</span><span class="o">;</span> <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;official@example.com&quot;</span><span class="o">;</span> <span class="n">body</span> <span class="o">=</span> <span class="s2">&quot;My third message&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123124&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms x2&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Hello by sms x3&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+447888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;I won&#39;t be sent!&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;+447777123123&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+ab7888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Neither will I!&quot;</span> <span class="o">}</span>
        <span class="nc">Sms</span> <span class="o">{</span> <span class="n">toNumber</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="o">;</span> <span class="n">fromNumber</span> <span class="o">=</span> <span class="s2">&quot;+ab7888321321&quot;</span><span class="o">;</span> <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;..and I definitely won&#39;t!&quot;</span> <span class="o">}</span>
    <span class="o">]</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>
<h2>Tag &#39;11&#39;</h2>

<p>The extra credit section! I very much doubt I&#39;ll get this far in a one hour session, but if I do this is just some fun playing with type providers. Also covers randomness such as:</p>

<ul>
<li>generating infinite sequences using <code>seq</code> expressions</li>
<li>double back tick identifiers</li>
<li>pattern matching with guards</li>
<li>a bit more of a workout of the <code>Seq</code> module</li>
<li>we can have a lot of discussion of lazy evaluation, because this code is just insanely broken without it</li>
</ul>
<div class="highlight"><pre><code class="fsharp"><span class="k">open</span> <span class="nc">System</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">IO</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Net</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Net</span><span class="p">.</span><span class="nc">Mail</span>
<span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nn">Text</span><span class="p">.</span><span class="nc">RegularExpressions</span>

<span class="k">type</span> <span class="nc">EmailDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromAddress</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">body</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">SmsDetails</span> <span class="o">=</span>
    <span class="o">{</span>
        <span class="n">toNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">fromNumber</span> <span class="o">:</span> <span class="kt">string</span>
        <span class="n">message</span> <span class="o">:</span> <span class="kt">string</span>
    <span class="o">}</span>

<span class="k">type</span> <span class="nc">MessageDetails</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="k">of</span> <span class="nc">EmailDetails</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="k">of</span> <span class="nc">SmsDetails</span>

<span class="k">let</span> <span class="o">(|</span><span class="nc">ValidSmsRequest</span><span class="o">|</span><span class="nc">InvalidSmsRequest</span><span class="o">|)</span> <span class="n">details</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">regex</span> <span class="o">=</span> <span class="nc">Regex</span><span class="o">(@</span><span class="s2">&quot;^</span><span class="err">\</span><span class="s2">+</span><span class="err">\</span><span class="s2">d</span><span class="err">\</span><span class="s2">d&quot;</span><span class="o">)</span>
    <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="nc">IsMatch</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="n">toNumber</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">regex</span><span class="o">.</span><span class="nc">IsMatch</span><span class="o">(</span><span class="n">details</span><span class="o">.</span><span class="n">fromNumber</span><span class="o">)</span> <span class="k">then</span>
        <span class="nc">ValidSmsRequest</span> <span class="n">details</span>
    <span class="k">else</span>
        <span class="nc">InvalidSmsRequest</span> <span class="s2">&quot;You must include the +xx country prefix on mobile numbers.&quot;</span>

<span class="k">let</span> <span class="n">sendEmail</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">use</span> <span class="n">smtpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SmtpClient</span><span class="o">(</span><span class="s2">&quot;smtp.local&quot;</span><span class="o">)</span>
        <span class="k">use</span> <span class="n">mailMessage</span> <span class="o">=</span> 
            <span class="k">new</span> <span class="nc">MailMessage</span><span class="o">(</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromAddress</span><span class="o">,</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toAddress</span><span class="o">)</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Subject</span> <span class="o">&lt;-</span> <span class="s2">&quot;Message subject&quot;</span>
        <span class="n">mailMessage</span><span class="o">.</span><span class="nc">Body</span> <span class="o">&lt;-</span> <span class="n">messageDetails</span><span class="o">.</span><span class="n">body</span>
        <span class="k">do</span><span class="o">!</span>
            <span class="n">smtpClient</span><span class="o">.</span><span class="nc">SendMailAsync</span><span class="o">(</span><span class="n">mailMessage</span><span class="o">)</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitIAsyncResult</span>
            <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Ignore</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent a mail message!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="k">private</span> <span class="n">postSms</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="n">async</span> <span class="o">{</span>
        <span class="k">let</span> <span class="n">http</span> <span class="o">=</span> <span class="nn">HttpWebRequest</span><span class="p">.</span><span class="nc">Create</span><span class="o">(</span><span class="s2">&quot;http://sms.local&quot;</span><span class="o">)</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebRequest</span>
        <span class="n">http</span><span class="o">.</span><span class="nc">Method</span> <span class="o">&lt;-</span> <span class="s2">&quot;POST&quot;</span>
        <span class="k">let</span> <span class="n">messagePayload</span> <span class="o">=</span>
            <span class="n">sprintf</span>
                <span class="s2">&quot;To: %s</span><span class="se">\n</span><span class="s2">From: %s</span><span class="se">\n</span><span class="s2">Message: %s&quot;</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">toNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">fromNumber</span>
                <span class="n">messageDetails</span><span class="o">.</span><span class="n">message</span>
        <span class="n">using</span> 
            <span class="o">(</span><span class="n">http</span><span class="o">.</span><span class="nc">GetRequestStream</span><span class="bp">()</span><span class="o">)</span>
            <span class="o">(</span><span class="k">fun</span> <span class="n">stream</span> <span class="o">-&gt;</span> 
                <span class="k">use</span> <span class="n">sw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamWriter</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>
                <span class="n">sw</span><span class="o">.</span><span class="nc">Write</span><span class="o">(</span><span class="n">messagePayload</span><span class="o">))</span>
        <span class="k">let</span><span class="o">!</span> <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="nc">GetResponseAsync</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">AwaitTask</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">response</span> <span class="o">:?&gt;</span> <span class="nc">HttpWebResponse</span><span class="o">).</span><span class="nc">StatusCode</span> <span class="o">&lt;&gt;</span> <span class="nn">HttpStatusCode</span><span class="p">.</span><span class="nc">OK</span> <span class="k">then</span>
            <span class="n">failwith</span> <span class="s2">&quot;Http request failed!&quot;</span>
        <span class="n">printfn</span> <span class="s2">&quot;I&#39;ve sent an SMS!&quot;</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">sendSms</span> <span class="n">messageDetails</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">messageDetails</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">ValidSmsRequest</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">postSms</span> <span class="n">details</span>
    <span class="o">|</span> <span class="nc">InvalidSmsRequest</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="n">async</span> <span class="o">{</span> <span class="n">printfn</span> <span class="s2">&quot;Sms sending error: %s&quot;</span> <span class="n">error</span> <span class="o">}</span>

<span class="k">let</span> <span class="n">sendMessage</span> <span class="n">message</span> <span class="o">=</span>
    <span class="k">match</span> <span class="n">message</span> <span class="k">with</span>
    <span class="o">|</span> <span class="nc">Email</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendEmail</span> <span class="n">details</span>
    <span class="o">|</span> <span class="nc">Sms</span> <span class="n">details</span> <span class="o">-&gt;</span> <span class="n">sendSms</span> <span class="n">details</span>

<span class="c">(* And now for something completely different...</span>

<span class="c">Let&#39;s send a bunch of actors and celebrities a selection </span>
<span class="c">of astronomical data. Because, you know. Why not?</span>

<span class="c">If you&#39;re running this code at home, you&#39;ll need</span>
<span class="c">to install the nuget package from the packages.config</span>
<span class="c">file *)</span>
<span class="k">open</span> <span class="nn">FSharp</span><span class="p">.</span><span class="nc">Data</span>
<span class="k">let</span> <span class="nc">FreebaseKey</span> <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span class="n">getKey</span> <span class="o">(</span><span class="n">dir</span> <span class="o">:</span> <span class="nc">DirectoryInfo</span><span class="o">)</span> <span class="o">=</span>
        <span class="k">match</span> <span class="n">dir</span><span class="o">.</span><span class="nc">EnumerateFiles</span><span class="o">(</span><span class="s2">&quot;freebase.key&quot;</span><span class="o">)</span> <span class="k">with</span>
        <span class="o">|</span> <span class="n">files</span> <span class="k">when</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">files</span> <span class="o">-&gt;</span> <span class="n">getKey</span> <span class="o">(</span><span class="n">dir</span><span class="o">.</span><span class="nc">Parent</span><span class="o">)</span>
        <span class="o">|</span> <span class="n">files</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">head</span> <span class="n">files</span><span class="o">).</span><span class="nc">OpenText</span><span class="bp">()</span><span class="o">.</span><span class="nc">ReadToEnd</span><span class="bp">()</span><span class="o">.</span><span class="nc">Trim</span><span class="bp">()</span>
    <span class="k">let</span> <span class="n">dir</span> <span class="o">=</span> <span class="nc">DirectoryInfo</span><span class="o">(</span><span class="nn">Directory</span><span class="p">.</span><span class="nc">GetCurrentDirectory</span><span class="bp">()</span><span class="o">)</span>
    <span class="n">getKey</span> <span class="n">dir</span>

<span class="k">type</span> <span class="nc">FreebaseProvider</span> <span class="o">=</span> <span class="nc">FreebaseDataProvider</span><span class="o">&lt;</span><span class="nc">Key</span><span class="o">=</span><span class="s2">&quot;api key goes here&quot;</span><span class="o">&gt;</span>

<span class="k">let</span> <span class="n">freebase</span> <span class="o">=</span> <span class="nn">FreebaseProvider</span><span class="p">.</span><span class="nc">GetDataContext</span><span class="bp">()</span>

<span class="c">(* If you don&#39;t have an api key you can delete lines</span>
<span class="c">88 to the end of this comment, and uncomment the line below.</span>

<span class="c">It will limit how many times you can run the program</span>
<span class="c">before it starts throwing authentication errors,</span>
<span class="c">though - there&#39;s a fairly strict rate limit. *)</span>
<span class="c1">//let freebase = FreebaseData.GetDataContext()</span>

<span class="k">let</span> <span class="n">actors</span> <span class="o">=</span>
    <span class="n">freebase</span><span class="o">.``</span><span class="nc">Arts</span> <span class="k">and</span> <span class="nc">Entertainment</span><span class="o">``.</span><span class="nn">Film</span><span class="p">.</span><span class="err">``</span><span class="nc">Film</span> <span class="n">actors</span><span class="o">``</span>
    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="ow">not</span> <span class="o">&lt;|</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">a</span><span class="o">.``</span><span class="nc">Film</span> <span class="n">performances</span><span class="o">``)</span>
    <span class="c">(* You get a (virtual) cookie if you can work out</span>
<span class="c">    why I&#39;ve added the filter below *)</span>
    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">a</span> <span class="o">-&gt;</span> 
        <span class="o">(</span><span class="n">a</span><span class="o">.``</span><span class="nc">Film</span> <span class="n">performances</span><span class="o">``</span> <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span><span class="o">)</span>
            <span class="o">.</span><span class="nn">Film</span><span class="p">.</span><span class="nn">Name</span><span class="p">.</span><span class="err">[0</span> <span class="p">..</span> <span class="err">0]</span>
        <span class="err">|&gt;</span> <span class="nc">Regex</span><span class="o">(</span><span class="s2">&quot;[a-zA-Z]&quot;</span><span class="o">).</span><span class="nc">IsMatch</span><span class="o">)</span>
    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="ow">not</span> <span class="o">&lt;|</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">a</span><span class="o">.``</span><span class="nc">Country</span> <span class="k">of</span> <span class="n">nationality</span><span class="o">``)</span>
    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">take</span> <span class="mi">20</span>

<span class="k">let</span> <span class="n">encode</span> <span class="o">(</span><span class="n">str</span> <span class="o">:</span> <span class="kt">string</span><span class="o">)</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">clean</span> <span class="o">=</span> <span class="nc">Regex</span><span class="o">(</span><span class="s2">&quot;</span><span class="err">\</span><span class="s2">W&quot;</span><span class="o">)</span>
    <span class="n">clean</span><span class="o">.</span><span class="nc">Replace</span><span class="o">(</span><span class="n">str</span><span class="o">,</span> <span class="s2">&quot;-&quot;</span><span class="o">)</span>

<span class="k">let</span> <span class="n">emailAddresses</span> <span class="o">=</span>
    <span class="n">seq</span> <span class="o">{</span> <span class="k">for</span> <span class="n">actor</span> <span class="k">in</span> <span class="n">actors</span> <span class="o">-&gt;</span> 
            <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="n">actor</span><span class="o">.</span><span class="nc">Name</span> <span class="o">|&gt;</span> <span class="n">encode</span>
            <span class="k">let</span> <span class="n">domain</span> <span class="o">=</span>
                <span class="o">(</span><span class="n">actor</span><span class="o">.``</span><span class="nc">Film</span> <span class="n">performances</span><span class="o">``</span> <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span><span class="o">).</span><span class="nn">Film</span><span class="p">.</span><span class="nc">Name</span>
                <span class="o">|&gt;</span> <span class="n">encode</span>
            <span class="k">let</span> <span class="n">countryCode</span> <span class="o">=</span>
                <span class="k">match</span> <span class="o">(</span><span class="n">actor</span><span class="o">.``</span><span class="nc">Country</span> <span class="k">of</span> <span class="n">nationality</span><span class="o">``</span> <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">head</span><span class="o">).``</span><span class="nc">ISO</span> <span class="nc">Alpha</span> <span class="mi">2</span><span class="o">``</span> <span class="k">with</span>
                <span class="o">|</span> <span class="n">alpha</span> <span class="k">when</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">isEmpty</span> <span class="n">alpha</span> <span class="o">-&gt;</span>
                    <span class="s2">&quot;com&quot;</span>
                <span class="o">|</span> <span class="n">alpha</span> <span class="k">when</span> <span class="o">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">head</span> <span class="n">alpha</span><span class="o">).</span><span class="nc">ToLower</span><span class="bp">()</span> <span class="o">=</span> <span class="s2">&quot;us&quot;</span> <span class="o">-&gt;</span>
                    <span class="s2">&quot;com&quot;</span>
                <span class="o">|</span> <span class="n">alpha</span> <span class="o">-&gt;</span> <span class="n">sprintf</span> <span class="s2">&quot;co.%s&quot;</span> <span class="o">&lt;|</span> <span class="o">(</span><span class="nn">Seq</span><span class="p">.</span><span class="n">head</span> <span class="n">alpha</span><span class="o">).</span><span class="nc">ToLower</span><span class="bp">()</span>
            <span class="n">sprintf</span> <span class="s2">&quot;%s@%s.%s&quot;</span>
                <span class="n">name</span>
                <span class="n">domain</span>
                <span class="n">countryCode</span> <span class="o">}</span>

<span class="c">(* We&#39;re going to need 20 planets for our 20 celebrities,</span>
<span class="c">so we&#39;ll repeat the planets as many times as we need *)</span>
<span class="k">let</span> <span class="n">planets</span> <span class="o">=</span>
    <span class="n">seq</span> <span class="o">{</span>
        <span class="k">while</span> <span class="bp">true</span> <span class="k">do</span>
            <span class="k">yield</span><span class="o">!</span> <span class="n">freebase</span><span class="o">.``</span><span class="nc">Science</span> <span class="k">and</span> <span class="nc">Technology</span><span class="o">``.</span><span class="nn">Astronomy</span><span class="p">.</span><span class="nc">Planets</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">messages</span> <span class="o">=</span>
    <span class="n">seq</span> <span class="o">{</span> <span class="k">for</span> <span class="n">planet</span> <span class="k">in</span> <span class="n">planets</span> <span class="o">-&gt;</span>
            <span class="n">sprintf</span> <span class="s2">&quot;&quot;&quot;Hi there!</span>
<span class="s2">We thought you might be interested to know that:</span>

<span class="s2">The planet %s has:</span>
<span class="s2">%d moons!</span>
<span class="s2">An average orbital velocity of %Am/s!</span>

<span class="s2">And is also known as:</span>
<span class="s2">%s</span>

<span class="s2">Regards,</span>

<span class="s2">Astro</span>
<span class="s2">                &quot;&quot;&quot;</span>
                <span class="n">planet</span><span class="o">.</span><span class="nc">Name</span>
                <span class="o">(</span><span class="n">planet</span><span class="o">.``</span><span class="nc">Orbited</span> <span class="n">by</span><span class="o">``</span> <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">length</span><span class="o">)</span>
                <span class="n">planet</span><span class="o">.``</span><span class="nc">Average</span> <span class="nc">Orbital</span> <span class="nc">Speed</span><span class="o">``</span>
                <span class="o">(</span><span class="n">planet</span><span class="o">.``</span><span class="nc">Also</span> <span class="n">known</span> <span class="k">as</span><span class="o">``</span> <span class="o">|&gt;</span> <span class="nn">String</span><span class="p">.</span><span class="n">concat</span> <span class="s2">&quot;, &quot;</span><span class="o">)</span> <span class="o">}</span>

<span class="k">let</span> <span class="n">combineAddressAndMessage</span> <span class="o">(</span><span class="n">address</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="o">=</span>
    <span class="nc">Email</span> <span class="o">{</span>
        <span class="n">toAddress</span> <span class="o">=</span> <span class="n">address</span>
        <span class="n">fromAddress</span> <span class="o">=</span> <span class="s2">&quot;astro@random.org&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">message</span>
    <span class="o">}</span>

<span class="k">let</span> <span class="n">myMessages</span> <span class="o">=</span>
    <span class="nn">Seq</span><span class="p">.</span><span class="n">zip</span> <span class="n">emailAddresses</span> <span class="n">messages</span>
    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">combineAddressAndMessage</span>

<span class="n">myMessages</span>
<span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="n">sendMessage</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">Parallel</span>
<span class="o">|&gt;</span> <span class="nn">Async</span><span class="p">.</span><span class="nc">RunSynchronously</span>
<span class="o">|&gt;</span> <span class="k">fun</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;Finished all sends!&quot;</span>

<span class="nn">System</span><span class="p">.</span><span class="nn">Console</span><span class="p">.</span><span class="nc">ReadLine</span><span class="bp">()</span> <span class="o">|&gt;</span> <span class="n">ignore</span>
</code></pre></div>]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Teaching F# to C# Devs]]></title>
    <link href="https://blog.mavnn.co.uk/teaching-f-number-to-c-number-devs/"/>
    <updated>2013-09-17T11:12:00+01:00</updated>
    <id>https://blog.mavnn.co.uk/teaching-f-number-to-c-number-devs</id>
    <content type="html"><![CDATA[<p>So, in a fit of enthusiasm my boss bought 15 tickets to the <a href="%22http://skillsmatter.com/event/scala/progressive-f-tutorials-2013%22">London Progressive F# Tutorials</a> when he saw the early birds pricing (did I mention it&#39;s nice working here?). Several of the people who have been assigned tickets have asked to go largely because they are new to F#, so I&#39;ve been asked to put together a starter session to teach them the basics. I&#39;ve tried this <a href="%22https//blog.mavnn.co.uk/an-introduction-to-f-screencast-and-pdf-slide%22">once before</a> and it was a fairly successful session (F# was adopted as a official supported language in the company partly due to feedback following it). But it was still pretty rough around the edges, and as normal with these things, you always want to do them better the next time round...</p>

<p>So, with a target audience of curious, experienced C# devs I&#39;m wondering about the best approach. The initial session needs to fit in an hour, although I can do individual follow ups afterwards.</p>

<p>My current thinking is to take a block of C# code (smtp sender?) that is fairly straight forward but &#39;production ready&#39; in the sense that it includes error handling, logging, etc. Then do a straight re-write in F# live coding. And then start refactoring to more idiomatic F# as we go along.</p>

<p>Features I feel would be important to cover:</p>

<ul>
<li>Basic syntax (let, functions, if ... then, etc)</li>
<li>Common idioms (|&gt;, Seq.map)</li>
<li>At least one computational expression (probably an error handling one; simpler than async in some ways)</li>
<li>Several examples of using the match statements</li>
<li>...which probably means at least one DU, possibly for error handling</li>
<li>Records and { ... with ... } expressions</li>
</ul>

<p>I&#39;ve got a week or two to prepare, so what I&#39;m really hoping for at this point is suggestions and ideas from people for how to improve this as a session idea, things that threw you when you first started writing F# you think should be covered, whether you think this is a stupid idea for a session from the concept up, etc. Once the session is completed I&#39;ll be posting the slides and hopefully a screen cast of it as I did last time for use by <a href="%22http://fsharp.org%22">fsharp.org</a>.</p>

<p>Suggestions on the piece of C# code to translate would also be appreciated - either in terms of ideas of the type of code, or actual open source code that would serve as a code starting point.</p>
]]></content>
  </entry>
  
</feed>
