
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Type Providers From the Ground Up - Mavnn's blog</title>
  <meta name="author" content="mavnn">

  
  <meta name="description" content="This post is part of a series: part 2 follows on directly from this post. In the ground tradition of blog posts as both documentation and augmented &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="canonical" href="https://blog.mavnn.co.uk/type-providers-from-the-ground-up/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mavnn's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Fira+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Fira+Mono:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-37561687-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body   >
  <header role="banner"><hgroup>
  <a href="https://mavnn.co.uk"><img class="swirl-logo" src="/images/swirl.svg"/></a>
  <h1><a href="/">Mavnn's blog</a></h1>
  
    <h2>Stuff from my brain</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="#" method="get" id="searchbox" >
  <fieldset role="search">
    <input type="hidden" id="site_query" value="site:blog.mavnn.co.uk" />
    <input class="search" type="text" name="q" results="0" id="search_query" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="https://mavnn.co.uk">Main Site</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  

<!-- for the course -->
<!-- <h5>We're running <a href="/cloud-native-net/">Cloud Native .NET</a> in Brighton, 26th-27th April 2018. High quality training for building .NET Core, distributed, production ready systems.</h5> -->
<!-- take it out up to here... -->



  <header>
    
      <h1 class="entry-title">Type Providers From the Ground Up</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-05T11:28:00+00:00" pubdate data-updated="true">Dec 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This post is part of a series: <a href="/type-providers-from-the-first-floor/">part 2</a> follows on directly from this post.</em></p>

<p>In the ground tradition of blog posts as both documentation and augmented memory, I&#39;ve just added our first <a href="http://blogs.msdn.com/b/dsyme/archive/2013/01/30/twelve-type-providers-in-pictures.aspx">Type Provider</a> to the code base. Time to write up the details before a) I forget them and b) anyone else needs to modify the code.</p>

<p>So, first things first. Before we get to the actual problem space at hand, let&#39;s try and provide a type. Any type&#8230;</p>

<p>1) Create yourself a new Visual Studio F# library project (2012 or up should work).</p>

<p>2a) Install the <a href="https://www.nuget.org/packages/FSharp.TypeProviders.StarterPack/">F# TypeProvider Starter Pack</a> or</p>

<p>2b) add <a href="https://raw.github.com/fsharp/FSharp.Data/master/src/CommonProviderImplementation/ProvidedTypes.fs">ProvidedTypes.fs</a> and <a href="https://raw.github.com/fsharp/FSharp.Data/master/src/CommonProviderImplementation/ProvidedTypes.fsi">ProvidedTypes.fsi</a> to the project as the first couple of files.</p>

<p>In either case, make sure that the .fsi file appears before the .fs file in your project listing, and that both appear before any type provider code - you will probably have to manually re-order them.</p>

<p>These are provided as code files rather than as compiled dlls due to complications with security and AppDomains when referencing dlls in the type provider assembly. For now just add them in - you really don&#39;t want to be re-creating the code in there by hand.</p>

<p>3) Replace the contents of Library1.fs with something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">module</span> <span class="nn">Mavnn</span><span class="p">.</span><span class="nn">Blog</span><span class="p">.</span><span class="nc">TypeProvider</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nn">ProviderImplementation</span><span class="p">.</span><span class="nc">ProvidedTypes</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">FSharp</span><span class="p">.</span><span class="nn">Core</span><span class="p">.</span><span class="nc">CompilerServices</span>
</span><span class='line'>
</span><span class='line'><span class="o">[&lt;</span><span class="nc">TypeProvider</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">type</span> <span class="nc">MavnnProvider</span> <span class="o">(</span><span class="n">config</span> <span class="o">:</span> <span class="nc">TypeProviderConfig</span><span class="o">)</span> <span class="k">as</span> <span class="n">this</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">inherit</span> <span class="nc">TypeProviderForNamespaces</span> <span class="bp">()</span>
</span><span class='line'>
</span><span class='line'><span class="o">[&lt;</span><span class="n">assembly</span><span class="o">:</span><span class="nc">TypeProviderAssembly</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">do</span> <span class="bp">()</span>
</span></code></pre></td></tr></table></div></figure>

<p>So, that&#39;s great and it builds. We have a type provider class and an assembly that knows it&#39;s a type providing assembly. Unfortunately, it doesn&#39;t actually provide any types yet. Let&#39;s try it.</p>

<!--more-->

<p>Update Library1.fs in your solution with something that looks like this, and then we&#39;ll run through what&#39;s going on, and how to test it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">module</span> <span class="nn">Mavnn</span><span class="p">.</span><span class="nn">Blog</span><span class="p">.</span><span class="nc">TypeProvider</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nn">ProviderImplementation</span><span class="p">.</span><span class="nc">ProvidedTypes</span>
</span><span class='line'><span class="k">open</span> <span class="nn">Microsoft</span><span class="p">.</span><span class="nn">FSharp</span><span class="p">.</span><span class="nn">Core</span><span class="p">.</span><span class="nc">CompilerServices</span>
</span><span class='line'><span class="k">open</span> <span class="nn">System</span><span class="p">.</span><span class="nc">Reflection</span>
</span><span class='line'>
</span><span class='line'><span class="o">[&lt;</span><span class="nc">TypeProvider</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">type</span> <span class="nc">MavnnProvider</span> <span class="o">(</span><span class="n">config</span> <span class="o">:</span> <span class="nc">TypeProviderConfig</span><span class="o">)</span> <span class="k">as</span> <span class="n">this</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">inherit</span> <span class="nc">TypeProviderForNamespaces</span> <span class="bp">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">ns</span> <span class="o">=</span> <span class="s2">&quot;Mavnn.Blog.TypeProvider.Provided&quot;</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">asm</span> <span class="o">=</span> <span class="nn">Assembly</span><span class="p">.</span><span class="nc">GetExecutingAssembly</span><span class="bp">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">createTypes</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">myType</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="n">asm</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s2">&quot;MyType&quot;</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">obj</span><span class="o">&gt;)</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">myProp</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span><span class="s2">&quot;MyProperty&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;,</span> <span class="nc">IsStatic</span> <span class="o">=</span> <span class="bp">true</span><span class="o">,</span>
</span><span class='line'>                                        <span class="nc">GetterCode</span> <span class="o">=</span> <span class="o">(</span><span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="s2">&quot;Hello world&quot;</span> <span class="o">@@&gt;))</span>
</span><span class='line'>        <span class="n">myType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">myProp</span><span class="o">)</span>
</span><span class='line'>        <span class="o">[</span><span class="n">myType</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">do</span>
</span><span class='line'>        <span class="n">this</span><span class="o">.</span><span class="nc">AddNamespace</span><span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">createTypes</span><span class="bp">()</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="o">[&lt;</span><span class="n">assembly</span><span class="o">:</span><span class="nc">TypeProviderAssembly</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">do</span> <span class="bp">()</span>
</span></code></pre></td></tr></table></div></figure>

<p>First things first - it looks like it should provide a class with a static property, but how do we test it?</p>

<p>It turns out it&#39;s harder than it looks. If you reference your brand new type provider in Visual Studio, that instance of Visual Studio will promptly lock the dll file. Which means you can&#39;t recompile it. So referencing the dll from within the instance of Visual Studio you&#39;re using to develop it is a no go.</p>

<p>Fire up a second copy of Visual Studio (you went for the extra RAM option on your hardware, yes?) and create an F# project in it. Add an fsx file that looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="c1">// Your path may vary...</span>
</span><span class='line'><span class="o">#</span><span class="n">r</span> <span class="o">@</span><span class="s2">&quot;../../Mavnn.Blog.TypeProvider/Mavnn.Blog.TypeProvider/bin/Debug/Mavnn.Blog.TypeProvider.dll&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nn">Mavnn</span><span class="p">.</span><span class="nn">Blog</span><span class="p">.</span><span class="nn">TypeProvider</span><span class="p">.</span><span class="nc">Provided</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Type `MyType.MyProperty` on next line down.</span>
</span></code></pre></td></tr></table></div></figure>

<p>Start typing, and&#8230; hurrah! Intellisense on your new, provided type with static property. Evaluate the script in F# interactive for one of the longest &quot;Hello World&quot; programs you&#39;ve ever seen.</p>

<p><em>You will need to close this instance of Visual Studio every time you want to recompile the type provider.</em></p>

<h2>What&#39;s going on here?</h2>

<p>We&#39;re declaring a new namespace and detecting the current assembly so we can inject things into it. During our initializing for the type provider, we then add that namespace to the assembly (<code>this.AddNamespace(...)</code>) along with a type created in the slightly (at the moment) misnamed <code>createTypes</code> method.</p>

<p>In <code>createTypes</code> we&#39;re first creating a type (<code>MyType</code>) which will be a direct member of the namespace we&#39;re creating (we&#39;ll get onto nested types shortly), then we&#39;re creating a static property and adding it to the type. <code>AddNamespace</code> takes a list of types, so will add the one we have to a list and pass it back.</p>

<p><code>MyType</code>&#39;s underlying representation in the CLR has been defined as <code>obj</code>, which means that if you try and access it in a non-F# language it will appear to the compiler as an <code>object</code>.</p>

<p>All well and good&#8230; except for the rather bizarre <code>&lt;@@ ... @@&gt;</code> syntax in our static property. Obviously, in some way it&#39;s creating a get method for the property that returns <code>&quot;Hello world&quot;</code>, but how does it do it? </p>

<p>This syntax represents a <a href="http://msdn.microsoft.com/en-us/library/dd233212.aspx">code quotation</a>, and rather than being compiled into your program it will compile to an object that represents an expression.</p>

<p>Did that make your brain hurt? Mine too&#8230; I&#39;m not going to go into quotations in great detail here (partly as I don&#39;t understand them well enough!) but we&#39;ll need to cover a couple of basics.</p>

<p>To give you a flavour, the quotation <code>&lt;@@ 1 + 2 @@&gt;</code> compiles to <code>Quotations.Expr = Call (None, op_Addition, [Value (1), Value (2)])</code>. Not very exciting so far, but how about:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">addI</span> <span class="n">i</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">&lt;@@</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">(%%</span><span class="n">i</span><span class="o">)</span> <span class="o">@@&gt;</span>
</span></code></pre></td></tr></table></div></figure>

<p>This gives a function of <code>Expr -&gt; Expr</code>, and now we can do things like <code>let add2 = addI &lt;@@ 2 @@&gt;</code> (gives <code>val add2 : Expr = Call (None, op_Addition, [Value (1), Value (2)])</code>) or <code>let add2MultipliedByX x = addI &lt;@@ 2 * x @@&gt;</code> (gives <code>val add2MultipliedByX : x:int -&gt; Expr</code>) and what we get back is effectively the AST of the first F# expression with the second spliced in to evaluate as you will. So in our <code>GetterCode</code> above, we are actually providing the AST that will be compiled into the <code>get_MyPropertyMethod</code> of the type when it is created.</p>

<p>The second thing that you need to know about quotations for current purposes is that the thing evaluating them may or may not be able to handle the F# expression you&#39;ve created. Which again we&#39;ll get back to in a moment!</p>

<p>So far, our type isn&#39;t very exciting. You can&#39;t even construct an instance of it. Let&#39;s see what we can do about that, with a replacement <code>createTypes</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">createTypes</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">myType</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="n">asm</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="s2">&quot;MyType&quot;</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">obj</span><span class="o">&gt;)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">myProp</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span><span class="s2">&quot;MyProperty&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;,</span> <span class="nc">IsStatic</span> <span class="o">=</span> <span class="bp">true</span><span class="o">,</span>
</span><span class='line'>                                    <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="s2">&quot;Hello world&quot;</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">myType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">myProp</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">ctor</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span><span class="bp">[]</span><span class="o">,</span> <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="s2">&quot;My internal state&quot;</span> <span class="o">:&gt;</span> <span class="n">obj</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">myType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">ctor</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">ctor2</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span>
</span><span class='line'>                    <span class="o">[</span><span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;InnerState&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;)],</span>
</span><span class='line'>                    <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="o">(%%(</span><span class="n">args</span><span class="o">.[</span><span class="mi">0</span><span class="o">]):</span><span class="kt">string</span><span class="o">)</span> <span class="o">:&gt;</span> <span class="n">obj</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">myType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">ctor2</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">innerState</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span><span class="s2">&quot;InnerState&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;,</span>
</span><span class='line'>                        <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="o">(%%(</span><span class="n">args</span><span class="o">.[</span><span class="mi">0</span><span class="o">])</span> <span class="o">:&gt;</span> <span class="n">obj</span><span class="o">)</span> <span class="o">:?&gt;</span> <span class="kt">string</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">myType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">innerState</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">[</span><span class="n">myType</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">do</span>
</span><span class='line'>    <span class="n">this</span><span class="o">.</span><span class="nc">AddNamespace</span><span class="o">(</span><span class="n">ns</span><span class="o">,</span> <span class="n">createTypes</span><span class="bp">()</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now we can construct our type (in two ways, no less). As the underlying CLR type is an <code>object</code> we can store pretty much anything as the internal representation of an instance of our type. The <code>InvokeCode</code> parameter of the constructors needs to return a quotation that will return the internal representation of the object when it&#39;s evaluated. We&#39;re going to return a string (which we need to cast to an obj), and using the splicing syntax above we can inject the parameters of the constructor into the quotation (for the constructor which has a parameter).</p>

<p>Similarly, we also add a property (notice that we&#39;re not setting it to be a static property this time). Because this property is not static, the first item in the <code>args</code> Array is the instance of the type itself (similar to the way that you define an extension method). So we can splice that into our method quotation (remembering to cast it from <code>obj</code> to <code>string</code>) and expose the underlying state of the object for all the world to see.</p>

<p>And now you can do things like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="c1">// Your path may vary...</span>
</span><span class='line'><span class="o">#</span><span class="n">r</span> <span class="o">@</span><span class="s2">&quot;../../Mavnn.Blog.TypeProvider/Mavnn.Blog.TypeProvider/bin/Debug/Mavnn.Blog.TypeProvider.dll&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">open</span> <span class="nn">Mavnn</span><span class="p">.</span><span class="nn">Blog</span><span class="p">.</span><span class="nn">TypeProvider</span><span class="p">.</span><span class="nc">Provided</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">thing</span> <span class="o">=</span> <span class="nc">MyType</span><span class="bp">()</span>
</span><span class='line'><span class="k">let</span> <span class="n">thingInnerState</span> <span class="o">=</span> <span class="n">thing</span><span class="o">.</span><span class="nc">InnerState</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">thing2</span> <span class="o">=</span> <span class="nc">MyType</span><span class="o">(</span><span class="s2">&quot;Some other text&quot;</span><span class="o">)</span>
</span><span class='line'><span class="k">let</span> <span class="n">thing2InnerState</span> <span class="o">=</span> <span class="n">thing2</span><span class="o">.</span><span class="nc">InnerState</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// val thing : Mavnn.Blog.TypeProvider.Provided.MyType = &quot;My internal state&quot;</span>
</span><span class='line'><span class="c1">// val thingInnerState : string = &quot;My internal state&quot;</span>
</span><span class='line'><span class="c1">// val thing2 : Mavnn.Blog.TypeProvider.Provided.MyType = &quot;Some other text&quot;</span>
</span><span class='line'><span class="c1">// val thing2InnerState : string = &quot;Some other text&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<h2>And the point is?</h2>

<p>Well - this is great, except the perceptive among you will have noticed that we&#39;re just generating a static type here. We could have just declared it using normal syntax.</p>

<p>So let&#39;s try going a step further. Let&#39;s say that we have some Json definitions of graph nodes types, each with a defined set of input and output &quot;ports&quot;. All of these graph bits are given to us as a Json array, and each Node type and port has a Guid identifier and a friendly name.</p>

<p>Our input JSON looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>         <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Simple&quot;</span><span class="p">,</span>
</span><span class='line'>         <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;0ab82262-0ad3-47d3-a026-615b84352822&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nt">&quot;Ports&quot;</span><span class="p">:[</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;4b69408e-82d2-4c36-ab78-0d2327268622&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;input&quot;</span>
</span><span class='line'>         <span class="p">},</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Output&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;92ae5a96-6900-4d77-832f-d272329f8a90&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;output&quot;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>   <span class="p">},</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>         <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Join&quot;</span><span class="p">,</span>
</span><span class='line'>         <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;162c0981-4370-4db3-8e3f-149f13c001da&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nt">&quot;Ports&quot;</span><span class="p">:[</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Input1&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;c0fea7ff-456e-4d4e-b5a4-9539ca134344&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;input&quot;</span>
</span><span class='line'>         <span class="p">},</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Input2&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;4e93c3b1-11bc-422a-91b8-e53204368714&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;input&quot;</span>
</span><span class='line'>         <span class="p">},</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Output&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;fb54728b-9602-4220-ba08-ad160d92d5a4&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;output&quot;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>   <span class="p">},</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>         <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Split&quot;</span><span class="p">,</span>
</span><span class='line'>         <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;c3e44941-9182-41c3-921c-863a82097ba8&quot;</span>
</span><span class='line'>      <span class="p">},</span>
</span><span class='line'>      <span class="nt">&quot;Ports&quot;</span><span class="p">:[</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;0ec2537c-3346-4503-9f5a-d0bb49e9e431&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;input&quot;</span>
</span><span class='line'>         <span class="p">},</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Output1&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;77b5a50c-3d11-4a67-b14d-52d6246e78c5&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;output&quot;</span>
</span><span class='line'>         <span class="p">},</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="nt">&quot;Id&quot;</span><span class="p">:{</span>
</span><span class='line'>               <span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="s2">&quot;Output2&quot;</span><span class="p">,</span>
</span><span class='line'>               <span class="nt">&quot;UniqueId&quot;</span><span class="p">:</span><span class="s2">&quot;d4d1e928-5347-4d51-be54-8650bdfe9bac&quot;</span>
</span><span class='line'>            <span class="p">},</span>
</span><span class='line'>            <span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="s2">&quot;output&quot;</span>
</span><span class='line'>         <span class="p">}</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>Things start getting a bit more in depth here, so you might want to check out the full code for this post, available on <a href="https://github.com/mavnn/Mavnn.Blog.TypeProvider">GitHub</a>, and follow along in your favourite development environment.</p>

<p>We&#39;ll let someone else deal with the parsing - add a Nuget reference to <code>Newtonsoft.Json</code> to your type provider, and let&#39;s have a third reprise of <code>createTypes</code>.</p>

<p>First, we&#39;ll need some classes to deserialize the Json into. Out of the box Newtonsoft doesn&#39;t do a great job on F# core classes (although that&#39;s changing), so for the moment we&#39;ll create some classic OO style mutable types:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="nc">Id</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">UniqueId</span> <span class="o">=</span> <span class="nc">Guid</span><span class="bp">()</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">Name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">Port</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">Id</span> <span class="o">=</span> <span class="nc">Id</span><span class="bp">()</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">Type</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">Node</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">Id</span> <span class="o">=</span> <span class="nc">Id</span><span class="bp">()</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span><span class='line'>    <span class="k">member</span> <span class="k">val</span> <span class="nc">Ports</span> <span class="o">=</span> <span class="nn">Collections</span><span class="p">.</span><span class="nn">Generic</span><span class="p">.</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Port</span><span class="o">&gt;</span><span class="bp">()</span> <span class="k">with</span> <span class="n">get</span><span class="o">,</span> <span class="n">set</span>
</span></code></pre></td></tr></table></div></figure>

<p>(Don&#39;t worry though, these aren&#39;t what we&#39;ll actually expose as the main interface.)</p>

<p>Turning our Json into the our new CLR types is straight forward:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">nodes</span> <span class="o">=</span>
</span><span class='line'>    <span class="nn">JsonConvert</span><span class="p">.</span><span class="nc">DeserializeObject</span><span class="o">&lt;</span><span class="n">seq</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;&gt;(</span><span class="nn">IO</span><span class="p">.</span><span class="nn">File</span><span class="p">.</span><span class="nc">ReadAllText</span><span class="o">(@</span><span class="s2">&quot;c:</span><span class="err">\</span><span class="s2">Temp</span><span class="err">\</span><span class="s2">Graph.json&quot;</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now the interesting part. To build a graph out of these nodes, we need to be able to do a few things.</p>

<p>Firstly, we need to be able to build a specific instance of a node type: which <code>Split</code> node is this? </p>

<p>Let&#39;s help ourselves out by having a concrete type as an the underlying type for our instances:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">type</span> <span class="n">nodeInstance</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nc">Node</span> <span class="o">:</span> <span class="nc">Node</span>
</span><span class='line'>        <span class="nc">InstanceId</span> <span class="o">:</span> <span class="nc">Id</span>
</span><span class='line'>        <span class="nc">Config</span> <span class="o">:</span> <span class="kt">string</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">module</span> <span class="k">private</span> <span class="nc">NodeInstance</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">create</span> <span class="n">node</span> <span class="n">name</span> <span class="n">guid</span> <span class="n">config</span> <span class="o">=</span>
</span><span class='line'>        <span class="o">{</span> <span class="nc">Node</span> <span class="o">=</span> <span class="n">node</span><span class="o">;</span> <span class="nc">InstanceId</span> <span class="o">=</span> <span class="nc">Id</span><span class="o">(</span><span class="nc">Name</span> <span class="o">=</span> <span class="n">name</span><span class="o">,</span> <span class="nc">UniqueId</span> <span class="o">=</span> <span class="n">guid</span><span class="o">);</span> <span class="nc">Config</span> <span class="o">=</span> <span class="n">config</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

<p>And then constructing a more specific type with a constructor for each node type we&#39;ve read from the Json:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">nodeType</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="n">asm</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">Name</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">nodeInstance</span><span class="o">&gt;)</span>
</span><span class='line'><span class="k">let</span> <span class="n">ctor</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span>
</span><span class='line'>            <span class="o">[</span>
</span><span class='line'>                <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;Name&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;)</span>
</span><span class='line'>                <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;UniqueId&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="nc">Guid</span><span class="o">&gt;)</span>
</span><span class='line'>                <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;Config&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;)</span>
</span><span class='line'>            <span class="o">],</span>
</span><span class='line'>            <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="o">[</span><span class="n">name</span><span class="o">;</span><span class="n">unique</span><span class="o">;</span><span class="n">config</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="nn">NodeInstance</span><span class="p">.</span><span class="n">create</span> <span class="o">(</span><span class="nc">GetNode</span> <span class="n">id</span><span class="o">)</span> <span class="o">(%%</span><span class="n">name</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">(%%</span><span class="n">unique</span><span class="o">:</span><span class="nc">Guid</span><span class="o">)</span> <span class="o">(%%</span><span class="n">config</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">@@&gt;)</span>
</span></code></pre></td></tr></table></div></figure>

<p>So now we can construct (look back at the json) a <code>Simple</code> node instance by using <code>let simple = Simple(&quot;simpleInstance&quot;, Guid.NewGuid(),&quot;MyConfig&quot;)</code>. And it already has our <code>InstanceId</code>, <code>Config</code> and <code>Node</code> properties from the underlying type.</p>

<p>Good progress - but we don&#39;t have a nice way of representing the inputs and outputs? We want to be able to write some kind of connection builder function afterwards that won&#39;t allow you to connect to outputs to each other, or similar silliness, so we&#39;re going to need separate types for inputs and outputs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="c1">// Check out the excellent article at F# for Fun and Profit</span>
</span><span class='line'><span class="c1">// on using single case Discriminated Unions for data modelling</span>
</span><span class='line'><span class="c1">// http://fsharpforfunandprofit.com/posts/designing-with-types-single-case-dus/</span>
</span><span class='line'>
</span><span class='line'><span class="k">type</span> <span class="nc">InputPort</span> <span class="o">=</span> <span class="o">|</span> <span class="nc">InputPort</span> <span class="k">of</span> <span class="nc">Port</span>
</span><span class='line'><span class="k">type</span> <span class="nc">OutputPort</span> <span class="o">=</span> <span class="o">|</span> <span class="nc">OutputPort</span> <span class="k">of</span> <span class="nc">Port</span>
</span></code></pre></td></tr></table></div></figure>

<p>And finally, we&#39;ll update our node creation function to add two subtypes to each node type called <code>Inputs</code> and <code>Outputs</code>, and then create properties on those objects to represent each port. Our full type creation for a node now looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">addInputPort</span> <span class="o">(</span><span class="n">inputs</span> <span class="o">:</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">)</span> <span class="o">(</span><span class="n">port</span> <span class="o">:</span> <span class="nc">Port</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">port</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span>
</span><span class='line'>                    <span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">Name</span><span class="o">,</span>
</span><span class='line'>                    <span class="n">typeof</span><span class="o">&lt;</span><span class="nc">InputPort</span><span class="o">&gt;,</span>
</span><span class='line'>                    <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nn">UniqueId</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span>
</span><span class='line'>                        <span class="o">&lt;@@</span> <span class="nc">GetPort</span> <span class="n">id</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">inputs</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">port</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">addOutputPort</span> <span class="o">(</span><span class="n">outputs</span> <span class="o">:</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">)</span> <span class="o">(</span><span class="n">port</span> <span class="o">:</span> <span class="nc">Port</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">port</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span>
</span><span class='line'>                    <span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">Name</span><span class="o">,</span>
</span><span class='line'>                    <span class="n">typeof</span><span class="o">&lt;</span><span class="nc">OutputPort</span><span class="o">&gt;,</span>
</span><span class='line'>                    <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span>
</span><span class='line'>                        <span class="k">let</span> <span class="n">id</span> <span class="o">=</span> <span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nn">UniqueId</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span>
</span><span class='line'>                        <span class="o">&lt;@@</span> <span class="nc">GetPort</span> <span class="n">id</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">outputs</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">port</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">addPorts</span> <span class="n">inputs</span> <span class="n">outputs</span> <span class="o">(</span><span class="n">portList</span> <span class="o">:</span> <span class="n">seq</span><span class="o">&lt;</span><span class="nc">Port</span><span class="o">&gt;)</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">portList</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">iter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">port</span> <span class="o">-&gt;</span>
</span><span class='line'>                    <span class="k">match</span> <span class="n">port</span><span class="o">.</span><span class="nc">Type</span> <span class="k">with</span>
</span><span class='line'>                    <span class="o">|</span> <span class="s2">&quot;input&quot;</span> <span class="o">-&gt;</span> <span class="n">addInputPort</span> <span class="n">inputs</span> <span class="n">port</span>
</span><span class='line'>                    <span class="o">|</span> <span class="s2">&quot;output&quot;</span> <span class="o">-&gt;</span> <span class="n">addOutputPort</span> <span class="n">outputs</span> <span class="n">port</span>
</span><span class='line'>                    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="n">failwithf</span> <span class="s2">&quot;Unknown port type for port %s/%s&quot;</span> <span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">Name</span> <span class="o">(</span><span class="n">port</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nn">UniqueId</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="o">))</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">createNodeType</span> <span class="n">id</span> <span class="o">(</span><span class="n">node</span> <span class="o">:</span> <span class="nc">Node</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">nodeType</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="n">asm</span><span class="o">,</span> <span class="n">ns</span><span class="o">,</span> <span class="n">node</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nc">Name</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">nodeInstance</span><span class="o">&gt;)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">ctor</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span>
</span><span class='line'>                <span class="o">[</span>
</span><span class='line'>                    <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;Name&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;)</span>
</span><span class='line'>                    <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;UniqueId&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="nc">Guid</span><span class="o">&gt;)</span>
</span><span class='line'>                    <span class="nc">ProvidedParameter</span><span class="o">(</span><span class="s2">&quot;Config&quot;</span><span class="o">,</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;)</span>
</span><span class='line'>                <span class="o">],</span>
</span><span class='line'>                <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="o">[</span><span class="n">name</span><span class="o">;</span><span class="n">unique</span><span class="o">;</span><span class="n">config</span><span class="o">]</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="nn">NodeInstance</span><span class="p">.</span><span class="n">create</span> <span class="o">(</span><span class="nc">GetNode</span> <span class="n">id</span><span class="o">)</span> <span class="o">(%%</span><span class="n">name</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">(%%</span><span class="n">unique</span><span class="o">:</span><span class="nc">Guid</span><span class="o">)</span> <span class="o">(%%</span><span class="n">config</span><span class="o">:</span><span class="kt">string</span><span class="o">)</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">nodeType</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">ctor</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">outputs</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="s2">&quot;Outputs&quot;</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">obj</span><span class="o">&gt;)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">outputCtor</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span><span class="bp">[]</span><span class="o">,</span> <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="n">obj</span><span class="bp">()</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">outputs</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">outputCtor</span><span class="o">)</span>
</span><span class='line'>    <span class="n">outputs</span><span class="o">.</span><span class="nc">HideObjectMethods</span> <span class="o">&lt;-</span> <span class="bp">true</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">let</span> <span class="n">inputs</span> <span class="o">=</span> <span class="nc">ProvidedTypeDefinition</span><span class="o">(</span><span class="s2">&quot;Inputs&quot;</span><span class="o">,</span> <span class="nc">Some</span> <span class="n">typeof</span><span class="o">&lt;</span><span class="n">obj</span><span class="o">&gt;)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">inputCtor</span> <span class="o">=</span> <span class="nc">ProvidedConstructor</span><span class="o">(</span><span class="bp">[]</span><span class="o">,</span> <span class="nc">InvokeCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="n">obj</span><span class="bp">()</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="n">inputs</span><span class="o">.</span><span class="nc">AddMember</span><span class="o">(</span><span class="n">inputCtor</span><span class="o">)</span>
</span><span class='line'>    <span class="n">inputs</span><span class="o">.</span><span class="nc">HideObjectMethods</span> <span class="o">&lt;-</span> <span class="bp">true</span>
</span><span class='line'>    <span class="n">addPorts</span> <span class="n">inputs</span> <span class="n">outputs</span> <span class="n">node</span><span class="o">.</span><span class="nc">Ports</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Add the inputs and outputs types of nested types under the Node type</span>
</span><span class='line'>    <span class="n">nodeType</span><span class="o">.</span><span class="nc">AddMembers</span><span class="o">([</span><span class="n">inputs</span><span class="o">;</span><span class="n">outputs</span><span class="o">])</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Now add some instance properties to expose them on a node instance.</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">outputPorts</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span><span class="s2">&quot;OutputPorts&quot;</span><span class="o">,</span> <span class="n">outputs</span><span class="o">,</span> <span class="bp">[]</span><span class="o">,</span>
</span><span class='line'>                        <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="n">obj</span><span class="bp">()</span> <span class="o">@@&gt;)</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">inputPorts</span> <span class="o">=</span> <span class="nc">ProvidedProperty</span><span class="o">(</span><span class="s2">&quot;InputPorts&quot;</span><span class="o">,</span> <span class="n">inputs</span><span class="o">,</span> <span class="bp">[]</span><span class="o">,</span>
</span><span class='line'>                        <span class="nc">GetterCode</span> <span class="o">=</span> <span class="k">fun</span> <span class="n">args</span> <span class="o">-&gt;</span> <span class="o">&lt;@@</span> <span class="n">obj</span><span class="bp">()</span> <span class="o">@@&gt;)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">nodeType</span><span class="o">.</span><span class="nc">AddMembers</span><span class="o">([</span><span class="n">inputPorts</span><span class="o">;</span><span class="n">outputPorts</span><span class="o">])</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">nodeType</span>
</span></code></pre></td></tr></table></div></figure>

<p>Leaving only one final mystery. What are the <code>GetPort</code> and <code>GetNode</code> methods - and why am I using them in the quotations rather than just using something like <code>&lt;@@ node @@&gt;</code>?</p>

<p>Well, if you remember I mentioned earlier that the evaluation of a quotation is limited by the implementation of the evaluator used. The type provider files you included right at the beginning contain an evaluator that turn a quotation into IL instructions - but, it doesn&#39;t include support for literals of custom types. In fact, if you check in <a href="https://github.com/fsharp/FSharp.Data/blob/master/src/CommonProviderImplementation/ProvidedTypes.fs#L1876">the relevant part of ProvidedTypes.fs</a> you&#39;ll see that it&#39;s actually quite prescriptive.</p>

<p>So, what we do is we build a couple of private helper methods that know how to find the correct port or node from one of the types that is allowed - in this case, a <code>string</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="k">private</span> <span class="n">nodes</span> <span class="o">=</span> <span class="nn">JsonConvert</span><span class="p">.</span><span class="nc">DeserializeObject</span><span class="o">&lt;</span><span class="n">seq</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;&gt;(</span><span class="nn">IO</span><span class="p">.</span><span class="nn">File</span><span class="p">.</span><span class="nc">ReadAllText</span><span class="o">(@</span><span class="s2">&quot;c:</span><span class="err">\</span><span class="s2">Temp</span><span class="err">\</span><span class="s2">Graph.json&quot;</span><span class="o">))</span>
</span><span class='line'>                    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nn">UniqueId</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span>
</span><span class='line'>                    <span class="o">|&gt;</span> <span class="nn">Map</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nc">GetNode</span> <span class="n">id</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">nodes</span><span class="o">.[</span><span class="n">id</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="k">private</span> <span class="n">ports</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">nodes</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Map</span><span class="p">.</span><span class="n">toSeq</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(_,</span> <span class="n">node</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">node</span><span class="o">.</span><span class="nc">Ports</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">concat</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Seq</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="n">p</span> <span class="o">-&gt;</span> <span class="n">p</span><span class="o">.</span><span class="nn">Id</span><span class="p">.</span><span class="nn">UniqueId</span><span class="p">.</span><span class="nc">ToString</span><span class="bp">()</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span>
</span><span class='line'>    <span class="o">|&gt;</span> <span class="nn">Map</span><span class="p">.</span><span class="n">ofSeq</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="nc">GetPort</span> <span class="n">id</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">ports</span><span class="o">.[</span><span class="n">id</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>So, there you have it. A complete, working type provider that uses meta data supplied in Json format to create CLR types. Lots of things still to be added for production ready code (delayed loading, handling multiple ports with the same names, not hard coding the filename, etc).</p>

<p><img src="/images/typeprovider.png" alt="Winning..."></p>

<p>Any questions or corrections, fire away. As mentioned, this is very much the first time I&#39;ve used type providers - but even this level of usage is providing a goodly amount of value for us.</p>

<p>And if you&#39;re ready for the next challenge&#8230; off to <a href="/type-providers-from-the-first-floor/">part 2</a> with you!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">mavnn</span></span>

      








  


<time datetime="2013-12-05T11:28:00+00:00" pubdate data-updated="true">Dec 5<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/fsharp/'>fsharp</a>, <a class='category' href='/blog/categories/programming/'>programming</a>, <a class='category' href='/blog/categories/typeprovider/'>typeprovider</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="https://blog.mavnn.co.uk/type-providers-from-the-ground-up/" data-via="mavnn" data-counturl="https://blog.mavnn.co.uk/type-providers-from-the-ground-up/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/to-infinity/" title="Previous Post: To Infinity and Beyond">&laquo; To Infinity and Beyond</a>
      
      
        <a class="basic-alignment right" href="/pygments/" title="Next Post: Pygments">Pygments &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Hire the Author</h1>
  <p>
    Want some help in any of the areas you've read about? Hop across to
    <a href="https://mavnn.co.uk">mavnn.co.uk</a> where you can hire the
    author.
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/working-from-home/">Working From Home, Pandemic Edition</a>
      </li>
    
      <li class="post">
        <a href="/free-probabilities/">Free Probabilities</a>
      </li>
    
      <li class="post">
        <a href="/shake-generated-files/">Shake: Generated Files</a>
      </li>
    
      <li class="post">
        <a href="/shake-linting/">Shake: Linting and Formatting</a>
      </li>
    
      <li class="post">
        <a href="/shake-the-intro/">Shake: The Intro</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/mavnn">@mavnn</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mavnn',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - mavnn -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = 'https://blog.mavnn.co.uk/type-providers-from-the-ground-up/';
        this.page.identifier = 'https://blog.mavnn.co.uk/type-providers-from-the-ground-up/';
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://mavnn.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>






  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script type="text/javascript">
 (function() {
   const searchbox = document.getElementById("searchbox");
   const site_query = document.getElementById("site_query").value;
   const search_query = document.getElementById("search_query");

   searchbox.onsubmit = function() {
     const q = encodeURIComponent(search_query.value);
     document.location.assign("https://google.com/search?q=" + site_query + "+" + q);
     return false;
   };
 })()
</script>


</body>
</html>
